{% extends "./modelo.html" %}
{% load static %}
{% block container %}
<head xmlns="http://www.w3.org/1999/html">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Untitled</title>
    <link rel="stylesheet" href="{% static 'PEDIDO/fontawesome-all.min.css' %}">
    <style>
    /* Estilos personalizados */

    .custom-background1 {
        background-color: #f2f2f2; /* Cor de fundo cinza claro */
        padding: 10px; /* Ajuste o valor do preenchimento conforme necessário */
    }

    .form-control {
  border: 1px solid black;
  border-radius: 5px;
  font-size: 95%;
}
    .form-control2 {
      border: none;
      border-radius: 0;
      border-bottom: none;
      font-size: 95%;
    }

    .form-control::placeholder {
      color: #999;
      font-size: 100%;
    }
    .form-control2::placeholder {
      color: #999;
      font-size: 100%;
    }

    .custom-margin-top {
      margin-top: 25px;
    }

    .gray-bg {
      background-color: #f8f9fa;
    }

    .cliente-container {
      background-color: #000;
      color: #fff;
      padding: 2px;
    }

    .modal-dialog {
      max-width: 900px; /* Ajuste o valor conforme necessário */
    }

    .modal-content {
      height: 400px; /* Ajuste o valor conforme necessário */
    }
    .form-wrapper {
      border: 1px solid black;
      padding: 10px;
    }





































    </style>
</head>
<body>
<section class="mt-2">
    <div class="container">
        <form method="post" id="form-nota-aberta" class="nota-aberta" action="/editaritensnf/{{ pedido.numero }}/">
            {% csrf_token %}
            <div class="row">
                <div class="col-md-6 align-items-center text-center mb-4"
                     style="margin-left: 200px; margin-right: auto;">
                    <h4><strong>NF ABERTA - PEDIDO {{ pedido.numero }} </strong></h4>
                </div>
               <div class="row">

                    <div id="dados-cliente" style="display: block;">
                        <fieldset style="font-size:10px; border: 1px solid black; border-radius: 10px;padding: 10px;">
                          <legend class="w-auto">Dados Cliente</legend>
                          <div class="row">
                            <div class="col-md-4">
                              <div class="form-group">
                                <label for="nome_cliente" class="form-label">Nome</label>
                                <input class="form-control" value="{{ pedido.cliente_pedido.nome }}" type="text" id="nome_cliente" name="nome" readonly >

                              </div>
                            </div>
                            <div class="col-md-3">
                              <div class="form-group">
                                <label for="documento_cliente" class="form-label">CPF / CNPJ </label>
                                <input class="form-control" type="text" value="{{ pedido.cliente_pedido.documento }}" id="documento_cliente" name="documento" readonly >
                              </div>
                            </div>
                            <div class="col-md-3">
                              <div class="form-group">
                                <label for="contato-cliente-cnpj" class="form-label">- Inscrição Estadual</label>
                                <input class="form-control" type="text" value="{{ pedido.cliente_pedido.inscricao_estadual|default:'' }}" id="contato-cliente-cnpj" name="contato_cnpj" readonly>
                              </div>
                            </div>
                            <div class="col-md-2">
                              <div class="form-group">
                                <label for="dt-abertura" class="form-label">Data de Abertura</label>
                                <input class="form-control" type="date" value="{{ pedido.cliente_pedido.dt_abertura|date:'Y-m-d' }}" id="dt-abertura" name="data-abertura" readonly>
                              </div>
                            </div>
                          </div>
                          <div class="row">
                            <div class="col-md-3">
                              <div class="form-group">
                                <label for="email-cliente" class="form-label">Email</label>
                                <input class="form-control" type="email" value="{{ pedido.cliente_pedido.email }}" id="email-cliente" name="email-cliente" readonly>
                              </div>
                            </div>
                            <div class="col-md-2">
                              <div class="form-group">
                                <label for="telefone1-cliente" class="form-label">Telefone 1</label>
                                <input class="form-control" type="tel" value="{{ pedido.cliente_pedido.telefone1 }}" id="telefone1-cliente" name="telefone1-cliente" readonly >
                              </div>
                            </div>
                            <div class="col-md-2">
                              <div class="form-group">
                                <label for="telefone2-cliente" class="form-label">Telefone 2</label>
                                <input class="form-control" type="tel" id="telefone2-cliente" value="{{ pedido.cliente_pedido.telefone2 }}" name="telefone2-cliente" readonly>
                              </div>
                            </div>
                            <div class="col-md-2">
                              <div class="form-group">
                                <label for="cep-cliente" class="form-label">CEP</label>
                                <input class="form-control" type="text" id="cep-cliente" value="{{ pedido.cliente_pedido.CEP }}" name="cep-cliente" readonly>
                              </div>
                            </div>
                          </div>
                          <div class="row">
                            <div class="col-md-3">
                              <div class="form-group">
                                <label for="bairro-cliente" class="form-label">Bairro</label>
                                <input class="form-control" type="text" value="{{ pedido.cliente_pedido.bairro }}" id="bairro-cliente" name="bairro-cliente" readonly >
                              </div>
                            </div>
                            <div class="col-md-3">
                              <div class="form-group">
                                <label for="cidade-cliente" class="form-label">Cidade</label>
                                <input class="form-control" type="text" id="cidade-cliente" value="{{ pedido.cliente_pedido.cidade }}" name="cidade-cliente" readonly>
                              </div>
                            </div>
                            <div class="col-md-2">
                              <div class="form-group">
                                <label for="estado-cliente" class="form-label">Estado</label>
                                <input class="form-control" type="text" id="estado-cliente" value="{{ pedido.cliente_pedido.estado }}" name="estado-cliente" readonly>
                              </div>
                            </div>
                            <div class="col-md-4">
                              <div class="form-group">
                                <label for="endereco-cliente" class="form-label">Endereço</label>
                                <input class="form-control" type="text" id="endereco-cliente" name="endereco-cliente" value="{{ pedido.cliente_pedido.endereco }}" readonly>
                              </div>
                            </div>
                            <div class="col-md-2">
                              <div class="form-group">
                                <label for="numero-endereco-cliente" class="form-label">Nº</label>
                                <input class="form-control" type="text" id="numero-endereco-cliente" value="{{ pedido.cliente_pedido.numero_endereco }}" name="numero-endereco-cliente" readonly>
                              </div>
                            </div>
                          </div>
                          <div class="row">
                            <div class="col-md-6">
                              <div class="form-group">
                                <label for="complemento-cliente" class="form-label">Complemento</label>
                                <input class="form-control" type="text" id="complemento-cliente" value="{{ pedido.cliente_pedido.complemento|default:'' }}" name="complemento-cliente" readonly>
                                  <label for="ponto-referencia-cliente" class="form-label">Ponto de Referência</label>
                                <input class="form-control" type="text" id="ponto-referencia-cliente" value="{{ pedido.cliente_pedido.ponto_referencia|default:'' }}" name="ponto-referencia-cliente" readonly>
                              </div>
                            </div>
                          </div>
                        </fieldset>
                    </div>
               </div>

                <div>
                        <div class="row mb-2">
                            <h6 class="cliente-heading" style="margin-top: 30px">Endereço da Entrega</h6>
                        </div>
                        <div id="enderecoForm" style="display" class="form-wrapper">
                            <div class="row">

                                    <div class="col-md-4">
                                        <div class="mb-2">
                                            <h8><small>CEP</small></h8>
                                            <div class="input-group">
                                                <input class="form-control InputBorder" type="text" id="cep-entrega"
                                                       style="font-size:12px;"
                                                       value="{{ pedido.cep_entrega }} "
                                                       name="cep" required>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <h8><small>Bairro</small></h8>
                                        <input class="form-control InputBorder" type="text" id="bairro-entrega"
                                               style="font-size:12px;"
                                               value="{{ pedido.bairro_entrega }}"
                                               name="bairro" required>
                                    </div>
                                    <div class="col-md-3">
                                        <h8><small>Cidade</small></h8>
                                        <input class="form-control InputBorder" type="text" id="cidade-entrega"
                                               style="font-size:12px;"
                                                value="{{ pedido.cidade_entrega }}"
                                               name="cidade" required>
                                    </div>
                                    <div class="col-md-1">
                                        <h8><small>UF</small></h8>
                                        <input class="form-control InputBorder" type="text" id="uf-entrega"
                                                value="{{ pedido.uf_entrega }}"
                                               style="font-size:12px;"
                                               name="uf" required>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-4">
                                        <h8><small>Logradouro</small></h8>
                                        <input class="form-control InputBorder" type="text" id="logradouro-entrega"
                                               style="font-size:12px;"
                                                value="{{ pedido.endereco_entrega }}"
                                               name="endereco" required>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="mb-1">
                                            <h8><small>Nº</small></h8>
                                            <div class="input-group">
                                                <input class="form-control InputBorder" type="number" id="numero_endereco"
                                                       style="font-size:12px;"
                                                        value="{{ pedido.numero_end_entrega }}"
                                                       name="numero_endereco" required>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <h8><small>Complemento</small></h8>
                                            <div class="input-group">
                                                <input class="form-control InputBorder" type="text" id="complemto_endereco"
                                                       style="font-size:12px;"
                                                        value="{{ pedido.complemento|default:'' }}"
                                                       name="complemento_endereco">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            <div class="col-md-4">
                                        <div class="mb-3">
                                            <h8><small>Ponto de Referencia</small></h8>
                                            <div class="input-group">
                                                <input class="form-control InputBorder" type="text" id="ponto_referencia"
                                                       style="font-size:12px;"
                                                        value="{{ pedido.ponto_referencia_entrega|default:'' }}"
                                                       name="ponto_referencia_entrega">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                        </div>
                 <div>
                        <div class="row mb-2">
                            <h6 class="cliente-heading" style="margin-top: 30px">Transportadora </h6>
                        </div>
                        <div id="transportadoraForm" style="display" class="form-wrapper">
                            <div class="row">

                                    <div class="col-md-4">
                                        <div class="mb-2">
                                            <h8><small>NOME</small></h8>
                                            <div class="input-group">
                                                <input class="form-control InputBorder" type="text" id="nome-transportadora"
                                                       style="font-size:12px;"
                                                       value=""
                                                       name="transportadora_nome" >
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <h8><small>CNPJ Transportadora</small></h8>
                                        <input class="form-control InputBorder" type="text" id="cnpj-transportadora"
                                               style="font-size:12px;"
                                               value=""
                                               name="documento_transportadora" >
                                    </div>
                                    <div class="col-md-3">
                                        <h8><small>Peso</small></h8>
                                        <input class="form-control InputBorder" type="text" id="peso"
                                               style="font-size:12px;"
                                                value=""
                                               name="peso">
                                    </div>
                                    <div class="col-md-1">
                                        <h8><small>Volumes</small></h8>
                                        <input class="form-control InputBorder" type="text" id="volumes"
                                                value=""
                                               style="font-size:12px;"
                                               name="volumes" >
                                    </div>
                                </div>

                                </div>

                        </div>
                <div class="row mb-2">
                            <h6 class="cliente-heading" style="margin-top: 30px">Informações Complementares </h6>
                            <div class="row">
                                <input class="form-control InputBorder" type="text" id="informacoes-complementares-nfe"
                                                       style="font-size:12px;"
                                                       value=""
                                                       name="informacoes_complementares" >
                            </div>
                </div>



                    <div class="row mb-3 custom-margin-top gray-bg">
                        <h5 class="text-center"><strong>Itens NF </strong></h5>

                        <div class="row mb-3 custom-margin-top gray-bg">

                            <table class="itens-pedido">
                                <div class="text-end">
                                    <button class="btn btn-dark btn-sm float-end mb-3 add-row text-white" type="button"
                                            id="add-row-button"><strong>adicionar item</strong></button>
                                </div>
                                <thead>
                                <tr>
                                    <th class="col-md-1 text-center"><small>Codigo do Item</small></th>
                                    <th class="col-md-1 text-center"><small>NCM do Item</small></th>
                                    <th class="col-md-6 text-center"><small>Nome do Item</small></th>
                                    <th class="col-md-1 text-center"><small>QTD</small></th>
                                    <th class="col-md-1 text-center"><small>valor un</small></th>
                                    <th class="col-md-1 text-center"><small>valor total</small></th>

                                    <th class="col-md-1 text-center"></th>

                                </tr>
                                </thead>
                                <tbody>
                                {% for item in itens %}
                                <tr>
                                    <td class="col-md-1 text-center ">
                                        <input  type="text" name="nfe_codigo_item"
                                               id="item-codigo" value="{{ item.produto.codigo }}"
                                               class="form-control item-codigo text-center">

                                    </td>
                                    <td class="col-md-1 text-center  ">
                                        <input  type="text" name="nfe_ncm_item"
                                               id="item-ncm" value="{{ item.produto.ncm }}"
                                               class="form-control item-ncm text-center">

                                    </td>

                                    <td class="col-md-6 text-center ">
                                        <input  type="text" name="nfe_nome_item"
                                               id="item-nome" value="{{ item.nome }} {{item.comprimento}}x{{item.largura}}"
                                               class="form-control item-nome text-center">

                                    </td>
                                    <td class="col-md-1 text-center item-quantidade ">
                                        <input type="number" name="nf_qtd_item"
                                               id="item-quantidade" value="{{ item.quantidade }}"
                                               class="form-control item-quantidade-i text-center">
                                    </td>
                                    <td class="col-md-1 item-preco text-center ">
                                        <input type="text" name="nfe_preco_item" id="item-preco"
                                               value="{{ item.preco }}"
                                               class="form-control item-preco-i text-center"></td>
                                    <td class="col-md-2 item-total text-center ">
                                        <input type="text" name="nfe_item_total" onchange="CalcularVTotal()"
                                               id="nfe_item_total"
                                               value="{{ item.total_item }}"
                                               class="form-control item-total-i text-center" readonly>
                                    </td>

                                    <td class="text-center">
                                        <a class="btn-danger btn-sm delete-row text-white" type="button"
                                                        id="delete-row"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash-fill" viewBox="0 0 16 16">
                                                      <path d="M2.5 1a1 1 0 0 0-1 1v1a1 1 0 0 0 1 1H3v9a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V4h.5a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H10a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1H2.5zm3 4a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 .5-.5zM8 5a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7A.5.5 0 0 1 8 5zm3 .5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 1 0z"/>
                                                    </svg></a></td>
                                </tr>
                                {% endfor %}
                            </table>

                        </div>

                    </div>

                    <div class="row mt-4">
                        <div class="col">

                            <div class="col">
                                <p id="pedido-total">Valor Total do Pedido Alterado: R$ 0.00</p>
                                <p id="pedido-total2">Valor Total do Pedido Anterior: R$ {{ pedido.valorTotal }}</p>

                            </div>


                        </div>
                    </div>


                </div>

            <button id="submit-button" type="submit" class="btn btn-dark">EMITIR NFe</button>
        </form>
    </div>
</section>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script src="{% static 'PEDIDO/bootstrap.min.js' %}"></script>
<script src="{% static 'PEDIDO/script.min.js' %}"></script>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js"></script>
<script>
    document.getElementById("submit-button").addEventListener("click", function() {
    event.preventDefault(); // Impede o envio do formulário tradicional

    var itens = [];
    var linhasItens = document.querySelectorAll(".itens-pedido tbody tr");

    linhasItens.forEach(function(linha) {
        var nomeItem = linha.querySelector(".item-nome").value;
        var quantidadeItem = linha.querySelector(".item-quantidade-i").value;
        var precoItem = linha.querySelector(".item-preco-i").value;
        var totalItem = linha.querySelector(".item-total-i").value.replace("R$", "").replace(".", "").replace(",", ".").trim();
        var codigo = linha.querySelector(".item-codigo").value;
        var ncm = linha.querySelector(".item-ncm").value;
        console.log(totalItem);

        var item = {

            codigo: codigo,
            ncm: ncm,
            nome: nomeItem,
            quantidade: quantidadeItem,
            preco: precoItem,
            total_item: totalItem
        };

        itens.push(item);
    });

      var informacoesComplementares = document.getElementById('informacoes-complementares-nfe').value;
      var numeroPedido = {{ pedido.numero }};
      var cepEntrega = document.getElementById('cep-entrega').value;
      var bairroEntrega = document.getElementById('bairro-entrega').value;
      var cidadeEntrega = document.getElementById('cidade-entrega').value;
      var ufEntrega = document.getElementById('uf-entrega').value;
      var logradouroEntrega = document.getElementById('logradouro-entrega').value;
      var numeroEntrega = document.getElementById('numero_endereco').value;
      var complementoEntrega = document.getElementById('complemto_endereco').value;
      var transportadoraNome = document.getElementById('nome-transportadora').value;
      var transportadoraDocumento = document.getElementById('cnpj-transportadora').value;
      var transportadoraPeso = document.getElementById('peso').value;
      var transportadoraVolume = document.getElementById('volumes').value;

       // Cria um objeto de dados para enviar na requisição
       var data = {
         numero_pedido: numeroPedido,
         informacoes_complementares: informacoesComplementares,
         cep_entrega: cepEntrega,
         cidade_entrega: cidadeEntrega,
         bairro_entrega: bairroEntrega,
         uf_entrega: ufEntrega,
         logradouro_entrega: logradouroEntrega,
         numero_entrega: numeroEntrega,
         complemento_entrega: complementoEntrega,
         transportadora: transportadoraNome,
         transportadora_cnpj: transportadoraDocumento,
         peso:transportadoraPeso,
         volume: transportadoraVolume,
         informacoes_complementares: informacoesComplementares,
         itens: itens
    };
    console.log(itens);


    // Faz a requisição para a view 'emitir_nota' usando fetch
    fetch('/emitir-nota-aberta/', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-CSRFToken': '{{ csrf_token }}'
      },
      body: JSON.stringify(data)
    })
    .then(function(response) {
      if (response.ok) {
        // Manipule a resposta da requisição conforme necessário
        return response.json();
      } else {
        throw new Error('Erro na requisição: ' + response.statusText);
      }
    })
    .then(data => {
        // Lógica de tratamento da resposta, se necessário
        console.log(data);

        // Verifique se existe a propriedade 'bankSlipUrl' no JSON de resposta
        if (data && data.hasOwnProperty('nfe')) {
            // Redirecione a página para a URL do PDF do boleto
            console.log(data.nfe);
            window.open(data.nfe, '_blank');

        }else if (data && data.hasOwnProperty('error')) {
            // Exiba a mensagem de erro em um alert
            alert('Erro: ' + data.error);
          } else {
            // Lógica de tratamento da resposta, se necessário
            console.log(data);
           }
    })
    .then(function(responseData) {
       if (responseData.error) {
        // Realize as ações necessárias para tratar o erro
        alert('Erro: ' + responseData.error);
      }else{
      console.log(responseData); }
      // Realize as ações necessárias com os dados da resposta
    })
        // ...
    .catch(function(error) {
      console.error('Erro: ' + error.message);
      if (error) {
        try {
          var errorResponse = JSON.parse(error.response);
          var errorMessage = errorResponse.mensagem;
          alert('Erro: ' + errorMessage);
        } catch (e) {
          alert('Erro na requisição: ' + error.message);
        }
      } else {
        alert('Erro na requisição: ' + error.message);
      }
    });

    });

</script>
<script>
    // Adicione este código JavaScript no seu arquivo HTML ou em um arquivo separado.
document.addEventListener("DOMContentLoaded", function() {
    // Seletor para os botões de exclusão
    var deleteButtons = document.querySelectorAll(".delete-row");

    // Função para excluir a linha da tabela
    function deleteTableRow(event) {
        event.preventDefault(); // Impede o comportamento padrão do link

        // Encontre a linha que contém o botão clicado
        var row = event.target.closest("tr");

        // Remova a linha da tabela
        if (row) {
            row.remove();
        }
    }

    // Adicione um manipulador de eventos de clique para cada botão de exclusão
    deleteButtons.forEach(function(button) {
        button.addEventListener("click", deleteTableRow);
    });
});
    $(document).on("click", ".delete-row", function() {
        var deleteButtons = document.querySelectorAll(".delete-row");

    // Função para excluir a linha da tabela
    function deleteTableRow(event) {
        event.preventDefault(); // Impede o comportamento padrão do link

        // Encontre a linha que contém o botão clicado
        var row = event.target.closest("tr");

        // Remova a linha da tabela
        if (row) {
            row.remove();
        }
    }

    // Adicione um manipulador de eventos de clique para cada botão de exclusão
    deleteButtons.forEach(function(button) {
        button.addEventListener("click", deleteTableRow);
    });
    });

</script>




<script>
    document.addEventListener("DOMContentLoaded", function () {
        const tableBody = document.querySelector(".itens-pedido tbody");
        const pedidoTotal = document.getElementById("pedido-total");

        // Função para calcular e atualizar o valor total do pedido
        function calcularValorTotal() {
            let total = 0;

            // Percorrer todas as linhas da tabela e somar os totais
            tableBody.querySelectorAll("tr").forEach(function (row) {
                const quantidade = parseFloat(row.querySelector(".item-quantidade input").value) || 0;
                const preco = parseFloat(row.querySelector(".item-preco input").value) || 0;
                const totalItem = parseFloat(row.querySelector(".item-total input").value) || 0;

                total += quantidade * preco || totalItem;
            });

            pedidoTotal.textContent = `Valor Total do Pedido Alterado: R$ ${total.toFixed(2)}`;
        }

        // Calcular o valor total quando houver alterações nos campos
        tableBody.addEventListener("input", function () {
            calcularValorTotal();
        });

        // Adicionar nova linha à tabela (código anterior)
        // Remover linha da tabela (código anterior)

    });
</script>

<script>
    // Função para formatar valores em moeda
    function formatCurrency(value) {
        return value.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
    }
    function CalcularTotalPedido() {
        var rows = document.querySelectorAll('.itens-pedido tbody tr');
        var totalPedido = 0;

        rows.forEach(function(row) {
            var quantidade = parseFloat(row.querySelector('.item-quantidade input').value);
            var precoUnitario = parseFloat(row.querySelector('.item-preco input').value.replace(',', '.')); // Substitua vírgula por ponto
            var totalItem = quantidade * precoUnitario;
            totalPedido += totalItem;
        });

        // Atualize o campo de valor total do pedido
        var pedidoTotalElement = document.getElementById('pedido-total');
        pedidoTotalElement.innerText = 'Valor Total do Pedido Alterado: ' + formatCurrency(totalPedido);
    }

    // Função para calcular o valor total do item e atualizar o valor total do pedido
    function CalcularVTotal() {
        var rows = document.querySelectorAll('.itens-pedido tbody tr');
        var totalPedido = 0;

        rows.forEach(function(row) {
            var quantidade = parseFloat(row.querySelector('.item-quantidade input').value);
            var precoUnitario = parseFloat(row.querySelector('.item-preco input').value.replace(',', '.')); // Substitua vírgula por ponto
            var totalItem = quantidade * precoUnitario;

            row.querySelector('.item-total input').value = formatCurrency(totalItem);
            totalPedido += totalItem;
        });

        // Atualize o valor total do pedido
        document.getElementById('total-pedido').innerText = 'Valor Total do Pedido: ' + formatCurrency(totalPedido);
    }

    // Adicione um ouvinte de eventos de input para os campos de quantidade e preço unitário
    var inputFields = document.querySelectorAll('.item-quantidade input, .item-preco input');
    inputFields.forEach(function(input) {
        input.addEventListener('input', CalcularVTotal);
    });
    CalcularTotalPedido();

    // Execute a função inicialmente para calcular o valor total
    CalcularVTotal();
</script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const addRowButton = document.getElementById("add-row-button");
        const tableBody = document.querySelector(".itens-pedido tbody");

        // Adicionar nova linha à tabela
        addRowButton.addEventListener("click", function () {
            const newRow = `
                <td class="col-md-1 text-center item-codigo">
                                        <input  type="text" name="nfe_codigo_item"
                                               id="item-codigo" value="{{ item.produto.codigo }}"
                                               class="form-control text-center">

                                    </td>
                                    <td class="col-md-1 text-center item-ncm ">
                                        <input  type="text" name="nfe_ncm_item"
                                               id="item-ncm" value="{{ item.produto.ncm }}"
                                               class="form-control  text-center">

                                    </td>

                                    <td class="col-md-6 text-center item-nome">
                                        <input  type="text" name="nfe_nome_item"
                                               id="item-nome" value="{{ item.nome }} {{item.comprimento}}x{{item.largura}}"
                                               class="form-control text-center">

                                    </td>
                                    <td class="col-md-1 text-center item-quantidade">
                                        <input type="number" name="nf_qtd_item"
                                               id="item-quantidade" value="{{ item.quantidade }}"
                                               class="form-control  text-center">
                                    </td>
                                    <td class="col-md-1 text-center item-preco">
                                        <input type="text" name="nfe_preco_item" id="item-preco"
                                               value="{{ item.preco }}"
                                               class="form-control text-center"></td>
                                    <td class="col-md-2 text-center item-total">
                                        <input type="text" name="nfe_item_total" onchange="CalcularVTotal()"
                                               id="nfe_item_total"
                                               value="{{ item.total_item }}"
                                               class="form-control text-center" readonly>
                                    </td>

                                    <td class="text-center">
                                        <a class="btn-danger btn-sm delete-row text-white" type="button"
                                                        id="delete-row"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash-fill" viewBox="0 0 16 16">
                                                      <path d="M2.5 1a1 1 0 0 0-1 1v1a1 1 0 0 0 1 1H3v9a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V4h.5a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H10a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1H2.5zm3 4a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 .5-.5zM8 5a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7A.5.5 0 0 1 8 5zm3 .5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 1 0z"/>
                                                    </svg></a></td>
                                </tr>`;
            tableBody.insertAdjacentHTML("beforeend", newRow);
        });

        // Remover linha da tabela

    });


    CalcularTotalPedido();
    CalcularVTotal();

</script>




</body>

</html>
{% endblock %}