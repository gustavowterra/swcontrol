{% extends "./modelo.html" %}
{% load static %}
{% block container %}
<head xmlns="http://www.w3.org/1999/html">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Untitled</title>
    <link rel="stylesheet" href="{% static 'PEDIDO/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'PEDIDO/fontawesome-all.min.css' %}">
    <style>
    /* Estilos personalizados */
     .table-field {
        border: 1px solid black;
        margin: 5px;
        border-radius: 0;
        font-size: 12px;
        padding: 5px; /* Adicione um preenchimento para espaçamento interno */
    }

    .custom-background1 {
        background-color: #f2f2f2; /* Cor de fundo cinza claro */
        padding: 30px; /* Ajuste o valor do preenchimento conforme necessário */

    }

    .form-control {
      border:solid 1px;
      border-radius: 2;
      font-size: 12px;
    }
    .form-control2 {
      border: none;
      border-radius: 0;
      border-bottom: none;
      font-size: 12px;
      margin: 5px;
      padding: 5px;
    }

    .form-control::placeholder {
      color: #999;
      font-size: 12px;
    }
    .form-control2::placeholder {
      color: #999;
      font-size: 12px;
    }

    .custom-margin-top {
      margin-top: 25px;
    }

    .gray-bg {
      background-color: #f8f9fa;
    }

    .cliente-container {
      background-color: #000;
      color: #fff;
      padding: 2px;
    }

    .modal-dialog {
      max-width: 900px; /* Ajuste o valor conforme necessário */
    }

    .modal-content {
      height: 550px; /* Ajuste o valor conforme necessário */
    }
    .form-wrapper {

      padding: 10px;
    }

    </style>
</head>
<body>
<section class="mt-2 custom-background1">
<!-- Modal Que Carrega o Cadastro de Cliente Caso Cliente Não Cadastrado -->
                        <div class="modal" id="modal-cadastro-cliente" tabindex="-1" role="dialog">
                            <div class="modal-dialog modal-lg" role="document">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title">Cadastro de Cliente</h5>
                                        <button id="fechar-modal" class="close" data-dismiss="modal"
                                                aria-label="Fechar">
                                            <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>
                                    <div class="modal-body">
                                        <!-- Aqui será exibido o formulário de cadastro do cliente -->
                                    </div>
                                </div>
                            </div>
                        </div>
    <div class="container custom-background1 ">
         <form method="post" id="form-pedido" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="row">
                <div class="col-md-6 align-items-center text-center mb-4"
                     style="margin-left: 200px; margin-right: auto;">
                    <h4><strong>NOVO PEDIDO</strong></h4>
                </div>
                <div class="row ">
                    <div class="col">

                        <div class="row mb-2 custom-background1">
                            <div class="col-md-4">
                                <label for="numero_pedido">Numero do Pedido</label>
                                <input type="text" class="form-control2 text-center" id="numero_pedido"
                                       name="numero_pedido"
                                       value="{{ novo_numero }}" readonly>
                            </div>
                            <div class="col-md-4">
                                <label for="data-pedido">Data do Pedido</label>
                                <input type="date" class="form-control2 text-center" id="data-pedido"
                                       placeholder="Data do Pedido"
                                       name="data-pedido">
                            </div>
                            <div class="col-md-4">
                                <label for="data_entrega">Data da Entrega</label>

                                <input type="date" class="form-control2 text-center" id="data_entrega"
                                       placeholder="Prazo de Entrega"
                                       name="data_entrega" required>
                    </div>
                        </div>
                    </div>
                     <div class="row mb-2 custom-margin-top">

                             <div class="col-md-3">
                               <label for="tipo-pedido">Tipo do Pedido</label>
                                 <select class="form-control" id="tipo-pedido" name="tipo_pedido">
                                     <option value="PADRAO" selected>PADRAO</option>
                                     <option value="REVENDA">REVENDA</option>
                                 </select>
                            </div>
                            {% if colaborador.funcao == 'Gerente' or colaborador.funcao == 'Financeiro' %}
                                 <div class="col-md-3">
                                        <label for="empresa-pedido">Empresa do Pedido</label>
                                        <select type="text" class="form-control text-center" id="empresa-pedido"
                                               name="empresa_pedido" required>
                                            {% for empresa in empresas %}
                                            <option value="{{ empresa.nome }}">{{ empresa.nome }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>

                            {% endif %}
                     </div>


                    <div class="row mb-2 custom-margin-top">
                        <div class="col-md-3">
                            <label for="clientes"> Nome do Cliente </label>
                            <input type="text" list="clientes" class="form-control"
                                   id="cliente-nome-busca" name="nome_cliente_busca">
                            <datalist id="clientes">
                                {% for cliente in clientes %}
                                <option value="{{ cliente.nome }}" data-cliente-documento="{{ cliente.documento }}">{{ cliente.nome|upper }}</option>
                                {% endfor %}
                            </datalist>
                        </div>
                        <div class="col-md-4">
                             <label for="documento-cliente">Documento Cliente</label>
                            <div class="input-group">
                                <input type="text" oninput="formatarDocumento()" class="form-control" id="documento-cliente"
                                       placeholder="CPF / CNPJ " name="documento_cliente" required>
                                <button class="btn btn-dark" id="buscar-cliente" type="button">Buscar</button>
                            </div>
                            <div id="mensagem-cliente-nao-encontrado"
                                 style="display: none; color: red; font-weight: bold;">CLIENTE NÃO CADASTRADO
                            </div>
                        </div>




                    </div>

                    <div id="dados-cliente" style="display: none;">
                        <fieldset style="font-size:10px; border: 1px solid black; border-radius: 10px;padding: 10px;">
                          <legend class="w-auto">Dados Cliente</legend>
                          <div class="row">
                            <div class="col-md-4">
                              <div class="form-group">
                                <label for="nome_cliente" class="form-label">Nome</label>
                                <input class="form-control" type="text" id="nome_cliente" name="nome" readonly>
                                  <input style="display:none;" class="form-control" type="text" id="cliente-boleto" name="boleto-cliente" readonly>
                              </div>
                            </div>
                            <div class="col-md-3">
                              <div class="form-group">
                                <label for="documento_cliente" class="form-label">CPF / CNPJ</label>
                                <input class="form-control" type="text" id="documento_cliente" name="documento" readonly>
                              </div>
                            </div>
                            <div class="col-md-3">
                              <div class="form-group">
                                <label for="contato-cliente-cnpj" class="form-label">Contato ref. CNPJ</label>
                                <input class="form-control" type="text" id="contato-cliente-cnpj" name="contato_cnpj">
                              </div>
                            </div>
                            <div class="col-md-2">
                              <div class="form-group">
                                <label for="dt-abertura" class="form-label">Data de Abertura</label>
                                <input class="form-control" type="date" id="dt-abertura" name="data-abertura" readonly>
                              </div>
                            </div>
                          </div>
                          <div class="row">
                            <div class="col-md-3">
                              <div class="form-group">
                                <label for="email-cliente" class="form-label">Email</label>
                                <input class="form-control" type="email" id="email-cliente" name="email-cliente">
                              </div>
                            </div>
                            <div class="col-md-2">
                              <div class="form-group">
                                <label for="telefone1-cliente" class="form-label">Telefone 1</label>
                                <input class="form-control" type="tel" id="telefone1-cliente" name="telefone1-cliente">
                              </div>
                            </div>
                            <div class="col-md-2">
                              <div class="form-group">
                                <label for="telefone2-cliente" class="form-label">Telefone 2</label>
                                <input class="form-control" type="tel" id="telefone2-cliente" name="telefone2-cliente">
                              </div>
                            </div>
                            <div class="col-md-2">
                              <div class="form-group">
                                <label for="cep-cliente" class="form-label">CEP</label>
                                <input class="form-control" type="text" id="cep-cliente" name="cep-cliente" readonly>
                              </div>
                            </div>
                          </div>
                          <div class="row">
                            <div class="col-md-3">
                              <div class="form-group">
                                <label for="bairro-cliente" class="form-label">Bairro</label>
                                <input class="form-control" type="text" id="bairro-cliente" name="bairro-cliente" readonly>
                              </div>
                            </div>
                            <div class="col-md-3">
                              <div class="form-group">
                                <label for="cidade-cliente" class="form-label">Cidade</label>
                                <input class="form-control" type="text" id="cidade-cliente" name="cidade-cliente" readonly>
                              </div>
                            </div>
                            <div class="col-md-2">
                              <div class="form-group">
                                <label for="estado-cliente" class="form-label">Estado</label>
                                <input class="form-control" type="text" id="estado-cliente" name="estado-cliente" readonly>
                              </div>
                            </div>
                            <div class="col-md-4">
                              <div class="form-group">
                                <label for="endereco-cliente" class="form-label">Endereço</label>
                                <input class="form-control" type="text" id="endereco-cliente" name="endereco-cliente" readonly>
                              </div>
                            </div>
                            <div class="col-md-2">
                              <div class="form-group">
                                <label for="numero-endereco-cliente" class="form-label">Nº</label>
                                <input class="form-control" type="text" id="numero-endereco-cliente" name="numero-endereco-cliente" readonly>
                              </div>
                            </div>
                          </div>
                          <div class="row">
                            <div class="col-md-6">
                              <div class="form-group">
                                <label for="complemento-cliente" class="form-label">Complemento</label>
                                <input class="form-control" type="text" id="complemento-cliente" name="complemento-cliente" readonly>
                                  <label for="ponto-referencia-cliente" class="form-label">Ponto de Referência</label>
                                <input class="form-control" type="text" id="ponto-referencia-cliente" name="ponto-referencia-cliente" >
                              </div>
                            </div>
                              <div class="col-md-4">
                              <div class="form-group">
                                <label for="tipo-cliente" class="form-label">Tipo Cliente</label>
                                <input class="form-control" type="text" id="tipo-cliente" name="tipo-cliente" readonly>
                              </div>
                            </div>
                               <div class="col-md-4">
                              <div class="form-group">
                                <label for="score-cliente" class="form-label">Score Cliente</label>
                                <input class="form-control" type="text" id="score-cliente" name="score-cliente" readonly>
                              </div>
                            </div>
                          </div>
                        </fieldset>
                    </div>
                        <fieldset style="border: 1px solid black; border-radius: 10px;padding: 10px; margin-left: 10px; margin-top: 10px;"  >
                            <legend style="font-size: 20px; "><small><strong> Selecione o Endereço de Entrega </strong></small></legend>
                            <div class="custom-control custom-radio">
                                <input type="radio" id="endereco-cadastro" class="custom-control-input"
                                       name="endereco-opcao" value="cadastro" checked>
                                <label class="form-label custom-control-label" for="endereco-cadastro">Endereço de
                                    Cadastro</label>
                            </div>
                            <div class="custom-control custom-radio">
                                <input type="radio" id="endereco-opcional" class="custom-control-input"
                                       name="endereco-opcao" value="opcional">
                                <label class="form-label custom-control-label" for="endereco-opcional">Outro
                                    Endereço</label>
                            </div>

                            <div>
                                <div id="enderecoForm" style="display: none;" class="form-wrapper">
                                    <div class="row">
                                        <div class="col-md-2">
                                            <h8><small>CEP</small></h8>
                                            <input class="form-control" type="text" id="cep-entrega"
                                                   name="cep-entrega-opcional">
                                        </div>
                                        <div class="col-md-2">
                                            <h8><small>Bairro</small></h8>
                                            <input type="text"
                                                   class="form-control text-center"
                                                   id="bairro-entrega" name="bairro-entrega-opcional">
                                        </div>

                                        <div class="col-md-2">
                                            <h8><small>Cidade</small></h8>
                                            <input class="form-control" type="text" id="cidade-entrega"
                                                   name="cidade-entrega-opcional">
                                        </div>
                                        <div class="col-md-1">
                                            <h8><small>UF</small></h8>
                                            <input class="form-control" type="text" id="uf-entrega"
                                                   name="uf-entrega-opcional">
                                        </div>
                                        <div class="col-md-4">
                                            <h8><small>Logradouro</small></h8>
                                            <input class="form-control" type="text" id="logradouro-entrega"
                                                   name="endereco-entrega-opcional">
                                        </div>
                                        <div class="col-md-1">
                                            <h8><small>Nº</small></h8>
                                            <input type="number"class="form-control"
                                                   id="numero-entrega" name="numero-endereco-opcional">
                                        </div>

                                    </div>
                                    <div class="row">
                                        <h8><small>Complemento</small></h8>
                                        <div class="col-md-6 mt-2">
                                            <input type="text" class="form-control"
                                                   id="complemento-endereco-opcional" name="complemento-endereco-opcional">
                                        </div>
                                        <h8><small>Ponto de Referência</small></h8>
                                        <div class="col-md-6 mt-2">
                                            <input type="text" class="form-control"
                                                   id="pontoreferencia-opcional" name="pontoreferencia-opcional">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </fieldset>
                        <fieldset style="border: 1px solid black; border-radius: 10px;padding: 10px; margin-left: 10px; margin-top: 10px;"  >
                            <legend style="font-size: 20px; "><small><strong> Tipo de Entrega </strong></small></legend>
                                <div class="col-md-2">
                                    <select class="form-control col-md-3" name="opcao_frete">
                                        <option value="propria">Entrega Própria</option>
                                        <option value="Transportadora">Transportadora</option>
                                        <option value="retirada">Retirada Cliente</option>
                                        </select>
                                </div>
                        </fieldset>

                    <div class="row mb-3 mt-2">
                        <div class="col-md-3">

                            <label for="vendedor1"><small><strong> Vendedor 1</strong></small></label>

                            <input type="text" list="vendedores1" class="form-control"
                                   id="vendedor1" name="vendedor1" value="{{ vendedor }}" onchange="calcularPrecoBase()" required>

                            <datalist id="vendedores1">
                                {% for vendedor in vendedores %}
                                <option value="{{ vendedor.nome|upper }}"></option>
                                {% endfor %}
                            </datalist>


                        </div>

                        <div class="col-md-3">
                            <label for="vendedor2"><small><strong> Vendedor 2</strong></small></label>
                            <input type="text" list="vendedores2" class="form-control"
                                   id="vendedor2" name="vendedor2">
                            <datalist id="vendedores2">
                                {% for vendedor in vendedores %}
                                <option value="{{ vendedor.nome|upper }}"></option>
                                {% endfor %}
                            </datalist>
                        </div>

                        <div class="row mb-3 mt-2">
                            <div class=" mt-4" style="border: 1px solid black; border-radius: 20px;padding: 30px; margin-left: 10px;" id="tabela-itens">

                            <h4 style="font-size: 20px;"><small><strong>Tabela de Produtos</strong></small></h4>
                            <div class="text-end">
                                <button class="btn btn-dark btn-sm float-end mb-3 add-row text-white" type="button"
                                        id="add-row-button">adicionar produto</button>
                            </div>

                            <table style="width: 1200px;" id="tabela">
                                <thead>
                                <tr>
                                    <th class="text-center form-control2" style="font-size:12px; height: 12px;width: 77.578px;">ITEM</th>
                                    <th class="text-center form-control2" style="font-size:12px; width: 80px;">TIPO ITEM</th>
                                    <th class="text-center form-control2" style="font-size:12px; width:200px;">PRODUTO</th>
                                    <th class="text-center form-control2"  style="font-size:12px; height: 12px; width: 77.578px;">QTD</th>
                                    <th class="text-center form-control2" style="font-size:12px; width: 123px;">COMPRIMENTO</th>
                                    <th class="text-center form-control2" style="font-size:12px; width: 123px;">LARGURA</th>
                                    <th class="text-center form-control2" style="font-size:12px; width:200px;">OBSERVAÇÃO</th>
                                    <th class="text-center form-control2" style="font-size:12px; width: 123px;"> VALOR UN</th>
                                    <th class="text-center form-control2" style="font-size:12px; width: 80px;"> DESCONTO</th>
                                    <th class="text-center form-control2" style="font-size:12px; width:100px;"> TOTAL </th>
                                    <th class="text-center form-control2" style="width: 50px;"></th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr>
                                    <td><input type="number" class="form-control2 item-id table-field text-center" style="width: 100%; font-size: 10px;"
                                               name="item_id" readonly></td>
                                    <td style="width: 125.516px;">
                                        <select class="form-control2 text-center table-field tipo_produto" style="width: 100%;" id="tipo-produto" name="tipo_produto">
                                            <option value="PADRAO" selected>PADRAO</option>
                                            <option value="BRINDE">BRINDE</option>
                                            <option value="ADICIONAL">ADICIONAL</option>
                                        </select>
                                    </td>

                                    <td style="width: 250.516px;">
                                        <input type="text" list="produtos" class="form-control2 produto produto-input table-field text-center"
                                               style="width: 100%; font-size: 10px;"
                                               required name="item"
                                               id="produto">
                                        <datalist id="produtos">
                                            {% for produto in produtos %}
                                            <option  value="{{ produto.descricao }}" data-id="{{ produto.id }}" data-prazo-fabricacao="{{ produto.prazo_fabricacao }} "></option>
                                            {% endfor %}
                                        </datalist>
                                    </td>

                                    <td><input type="number" class="form-control2 quantity table-field text-center" style="width: 100%;font-size: 10px;"
                                               name="item-quantidade" value="1"  required></td>
                                    <td><input type="text" class="form-control2 item-comprimento table-field text-center"
                                               style="width: 100%; font-size: 10px;"
                                               name="item-comprimento" required></td>
                                    <td>

                                            <input type="text" class="form-control2 item-largura table-field text-center"
                                                   style="width: 100%; font-size: 10px;"
                                                   name="item-largura" required>

                                    </td>
                                    <td> <input type="text" class="form-control2 table-field observacao-item text-center" style="width: 100%; font-size: 10px;"
                                               id="observacao-item" name="observacao-item" ></td>
                                    <td><input type="text" class="form-control2 unit-price table-field text-center" style="width: 100%; font-size: 10px;"
                                               id="preco-base" name="preco-item" required></td>
                                    <td><input type="text" class="form-control2 desconto-item table-field text-center" style="width: 100%; font-size: 10px;"
                                               id="desconto-item" name="desconto-item" ></td>

                                    <td class="text-center total">

                                    </td>

                                    <td class="text-center">
                                        <a class="del-row" href="javascript:void(0);">
                                            <button class="btn btn-danger btn-sm" type="button"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16">
                                              <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5Zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5Zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6Z"/>
                                              <path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1ZM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118ZM2.5 3h11V2h-11v1Z"/>
                                            </svg>
                                            </button>

                                        </a></td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                        <div class="row mt-4">
                        <div class="col">
                            <p id="total-sum" class="mb-2">Valor Total: R$ 0.00</p>
                            <p id="pedido-desconto" class="mb-2">Desconto: R$ 0.00</p>
                            <p id="order-total">Valor Total do Pedido: R$ 0.00</p>
                        </div>
                        <div class="col text-end">
                            <p>Vendedor 1</p>
                            <p id="comissao-percentual" class="mb-2">Comissão: 0.00 %</p>
                            <p id="total-comissao" class="mb-2">Total Comissão: R$ 0.00</p>
                            <p class="mt-4">Vendedor 2</p>
                            <p id="comissao-percentual-2" class="mb-2">Comissão: 0.00 %</p>
                            <p id="total-comissao-2" class="mb-2">Total Comissão: R$ 0.00</p>

                        </div>
                    </div>
                    <div class="row mb-3 custom-margin-top">
                        <div class="col-md-2">
                            <h6><strong><small>Repasse</small></strong></h6>
                            <input type="text"
                                   class="form-control acerto text-center"
                                   id="acerto" name="acerto">
                        </div>
                        <div class="col-md-2">
                            <h6><strong><small>Fundo</small></strong></h6>
                            <input type="text"
                                   class="form-control text-center"
                                   id="fundo" name="fundo">
                        </div>
                        <div class="col-md-2">
                            <h6><strong><small>Bordas</small></strong></h6>
                            <input type="text"
                                   class="form-control text-center"
                                   id="bordas" name="bordas">
                        </div>
                        <div class="col-md-2">
                            <h6><strong><small>Letras</small></strong></h6>
                            <input type="text"
                                   class="form-control text-center"
                                   id="letras" name="letras">
                        </div>
                        <div class="col-md-2">
                            <h6><strong><small>Logomarca</small></strong></h6>
                            <input type="text"
                                   class="form-control text-center"
                                   id="logomarca" name="logomarca">
                        </div>


                         <div class="col-md-4">
                            <h6><strong><small>Observação do Pedido</small></strong></h6>
                            <input type="text"
                                   class="form-control text-center"
                                   id="observacao" name="observacao">
                        </div>

                        <div class="col-md-4">
                            <h6><strong><small>Arquivo Layout</small></strong></h6>
                            <input type="file"
                                   class="form-control text-center"
                                   id="arquivo" name="arquivo" required>
                        </div>

                    </div>
                        <fieldset style="border: 1px solid black; border-radius: 10px;padding: 10px; margin-left: 10px; margin-top: 10px;"  >
                            <legend style="font-size: 20px; "><small><strong> Informacoes NFe </strong></small></legend>
                            <div class="row mb-3 custom-margin-top">
                                <div class="col-md-2">
                                    <h6><strong><small>Cliente Solicita?</small></strong></h6>
                                    <select class="form-control text-center col-md-2" id="cliente-nfe" name="pedido-nfe-opcao">
                                        <option value="nao" selected>NÃO</option>
                                        <option value="sim">SIM</option>
                                    </select>
                                </div>
                                <div class="col-md-2">
                                    <h6><strong><small>Nfe Antecipado?</small></strong></h6>
                                    <select class="form-control text-center col-md-2" id="cliente-nfe-antecipado" name="antecipado-nfe-opcao">
                                        <option value="nao" selected>NÃO</option>
                                        <option value="sim">SIM</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <h6><strong><small>Informações Complementares NFe</small></strong></h6>
                                    <textarea rows="4" cols="50" class="form-control text-center" id="informacoes-complementares" name="informacoes_complementares">

                                    </textarea>
                                </div>
                                <div class="col-md-2">
                                    <h6><strong><small>Valor Transportadora Nfe</small></strong></h6>
                                    <input type="text"
                                           class="form-control frete text-center"
                                           id="frete" name="frete">
                                </div>
                            </div>
                        </fieldset>



                    <div class="row mb-3 custom-margin-top gray-bg">
                        <h5><strong>Pagamento</strong></h5>
                        <div class="row mb-3 mt-4">
                            <div class="col-md-2">
                                <!-- CONFIGURA 1A FORMA DE PAGAMENTO -->
                                <label for="momento-pagamento-1"><small>Momento do Pagamento</small></label>
                                <select class="form-control text-center" id="momento-pagamento-1" name="momento-pagamento1">
                                    {% for momento in momentos %}
                                    <option value="{{ momento|upper }}">{{ momento|upper }}</option>
                                    {% endfor %}
                                </select>
                            </div>

                            <div class="col-md-2">
                                <label for="forma-pgto-1">Forma de Pagamento</label>
                                <select class="form-control text-center" id="forma-pgto-1" name="forma_pagamento1">
                                    {% for tipo in tipos_pagamentos %}
                                    <option value="{{ tipo.descricao|upper }}">{{ tipo.descricao|upper }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-md-2" id="total_pagamento_1" style="display:block;">
                                        <label for="total_pagamento1">Total</label>
                                        <input type="text" class="form-control total-pagamento1 text-center" id="total_pagamento1" name="total_1">
                            </div>
                            <div class="col-md-2" id="data-pagamento-antecipado" style="display:block;">
                                        <label for="data_antecipado" style="font-size:15px;"><small>Data Pagamento Antecipado</small></label>
                                        <input type="date" class="form-control text-center" id="data_antecipado" name="data_antecipado">
                            </div>
                            <div class="col-md-12" id="pagamento-parcelado" style="display:none;">
                                <div class="row">
                                    <div class="col-md-2">
                                        <label for="parcelas-1">Numero de Parcelas</label>
                                        <input type="number" class="form-control text-center" id="parcelas-1" name="parcelas_cartao_1">
                                    </div>
                                    <div class="col-md-2">
                                        <label for="valor-parcelado-1">Valor Parcelado</label>
                                        <input type="text" class="form-control text-center" id="valor-parcelado-1" name="valor_parcelado_cartao_1">
                                    </div>
                                </div>
                            </div>
                            <div class="row mt-4" id="row-detalhes-faturamento" style="display:none;">
                                <div class="row">
                                    <div class="col-md-3">
                                        <label for="total-parcelas">Parcelas</label>
                                        <input type="text" class="form-control text-center" id="total-parcelas" name="total_parcelas">
                                    </div>
                                    <div class="col-md-3">
                                        <label for="valor-parcelas">Valor Por Parcela</label>
                                        <input type="text" class="form-control text-center" id="valor-parcelas" name="valor_parcelas">
                                    </div>
                                    <div class="col-md-3">
                                        <label for="info-parcelas">Informações de Pagamento</label>
                                        <input type="text" class="form-control text-center" id="info-parcelas" name="informacoes_parcelas">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- CONFIGURA 2A FORMA DE PAGAMENTO -->
                        <div class="row mb-3 mt-4">
                            <div class="col-md-2">
                                <label for="momento-pagamento_2"><small>Momento do Pagamento 2</small> </label>
                                <select class="form-control text-center" id="momento-pagamento_2" name="momento-pagamento2">
                                   <option value=""></option>
                                    {% for momento in momentos %}
                                    <option value="{{ momento|upper }}">{{ momento|upper }}</option>
                                    {% endfor %}
                                </select>
                            </div>

                            <div class="col-md-2">
                                <label for="forma-pgto-2">Forma de Pagamento</label>
                                <select class="form-control text-center" id="forma-pgto-2" name="forma_pagamento2">
                                    <option value=""></option>
                                    {% for tipo in tipos_pagamentos %}
                                    <option value="{{ tipo.descricao|upper }}">{{ tipo.descricao|upper }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-md-2" id="total_pagamento_2">
                                        <label for="total_pg_2">Total</label>
                                        <input type="text" class="form-control text-center" id="total_pg_2" name="total_2">
                            </div>
                            <div class="col-md-2" id="data-pagamento-antecipado-2" style="display:block;">
                                        <label for="data_antecipado_2" style="font-size:15px;"><small>Data Pagamento Antecipado 2</small></label>
                                        <input type="date" class="form-control data-pagamento-antecipado-2 text-center" id="data_antecipado_2" name="data_antecipado_2">
                            </div>
                            <div class="col-md-12" id="pagamento-parcelado-2" style="display:none;">
                                <div class="row">
                                    <div class="col-md-2">
                                        <label for="parcelas-2">Numero de Parcelas</label>
                                        <input type="number" class="form-control text-center" id="parcelas-2" name="parcelas_cartao_2">
                                    </div>
                                     <div class="col-md-2">
                                        <label for="total_2">Valor Parcelado</label>
                                        <input type="text" class="form-control text-center" id="total_2" name="valor_parcelado_cartao_2">
                                    </div>
                                </div>
                            </div>
                            <div class="row mt-4" id="row-detalhes-faturamento-2" style="display:none;">
                                <div class="row">
                                    <div class="col-md-3">
                                        <label for="total-parcelas-2">Parcelas</label>
                                        <input type="text" class="form-control text-center" id="total-parcelas-2" name="total_parcelas_2">
                                    </div>
                                    <div class="col-md-3">
                                        <label for="valor-parcelas-2">Valor Por Parcela</label>
                                        <input type="text" class="form-control text-center" id="valor-parcelas-2" name="valor_parcelas_2">
                                    </div>

                                </div>
                            </div>
                        </div>


                        <div class="col-md-3">
                            <button id="submit-button" type="submit" class="btn btn-dark">Cadastrar Pedido</button>
                        </div>
                    </div>
                </div>
                </div>
                </div>
         </form>

    </div>

</section>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script src="{% static 'PEDIDO/bootstrap.min.js' %}"></script>
<script src="{% static 'PEDIDO/script.min.js' %}"></script>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js"></script>



<!-- SCRIPT PARA FORMATAR DOCUMENTOS -->
<script>
    function formatarDocumento() {
  var input = document.getElementById('documento-cliente');
  var valor = input.value.replace(/\D/g, ''); // Remove caracteres não numéricos

  // Verifica se é CPF (11 dígitos) ou CNPJ (14 dígitos)
  if (valor.length <= 11) {
    valor = valor.replace(/(\d{3})(\d)/, '$1.$2');
    valor = valor.replace(/(\d{3})(\d)/, '$1.$2');
    valor = valor.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
  } else {
    valor = valor.replace(/^(\d{2})(\d)/, '$1.$2');
    valor = valor.replace(/^(\d{2})\.(\d{3})(\d)/, '$1.$2.$3');
    valor = valor.replace(/\.(\d{3})(\d)/, '.$1/$2');
    valor = valor.replace(/(\d{4})(\d)/, '$1-$2');
  }

  input.value = valor;
}
</script>
<!-- SCRIPT PARA BUSCA DE CEP ENTREGA -->
<script>
  $(document).ready(function() {
  console.log('entrou');
    $('#cep-entrega').on('keyup', function() {
      var cep = $(this).val().replace(/\D/g, '');
      if (cep.length == 8) {
        $.ajax({
          url: '/consultar_cep/',
          type: 'GET',
          data: { 'cep': cep },
          dataType: 'json',
          success: function(data) {
          var localidade = data.bairro + ', ' + data.localidade + ' - ' + data.uf;
          $('#bairro-entrega').val(data.bairro);
          $('#cidade-entrega').val(data.localidade);
          $('#uf-entrega').val(data.uf);
          $('#logradouro-entrega').val(data.logradouro);
        }
        });
      }
    });
   $('#cep-entrega').on('keyup', function() {
    var cep = $(this).val().replace(/\D/g, '');
    cep = cep.replace(/^(\d{5})(\d)/, '$1-$2');
    $(this).val(cep);
  });
  });

    </script>
<!-- SCRIPT PARA BUSCAR VENDEDOR 1 E SUAS RESPECTIVAS COMISSÕES
<script>
    $(document).ready(function () {
      $("#vendedor1").change(function () {
        var selectedVendedor = $(this).val();
        $.ajax({
          type: "GET",
          url: "/get-comissoes/",
          data: {
            vendedor: selectedVendedor
          },
          success: function (response) {
            var options = response.comissoes; // Extrai as opções de comissão do objeto de resposta
            var uniqueOptions = Array.from(new Set(options)); // Filtra os valores repetidos

            var optionsHtml = ""; // String para armazenar as tags <option>

            // Gera as tags <option> com base nas opções de comissão filtradas
            for (var i = 0; i < uniqueOptions.length; i++) {
              var optionValue = uniqueOptions[i] + "%"; // Adiciona o símbolo "%" ao valor da opção
              optionsHtml += "<option value='" + optionValue + "'>" + optionValue + "</option>";
            }

            // Atualiza o conteúdo do campo "Comissão 1" com as opções de comissão filtradas
            $("#comissao1").html(optionsHtml);
          },
          error: function (xhr, errmsg, err) {
            console.log(xhr.status + ": " + xhr.responseText);
          }
        });
      });
    });













</script>-->
<!-- SCRIPT PARA BUSCAR CLIENTE PELO CPF / CNPJ -->
<script>

$(document).ready(function () {
  $("#buscar-cliente").click(function () {
    var tipoPedido = $("#tipo-pedido").val();
    console.log(tipoPedido);
    var nomeCliente = $("#cliente-nome-busca").val();
    var documentoClienteNome = $("#clientes option[value='" + nomeCliente + "']").attr('data-cliente-documento');
    console.log(documentoClienteNome);
    var documentoCliente = $("#documento-cliente").val();
    var numeroPedido = $("#numero_pedido").val();



    $.ajax({
      type: "GET",
      url: "/get-cliente/",
      data: {
        documento: documentoCliente,
        documento2: documentoClienteNome,
        tipo_pedido: tipoPedido,
        numero_pedido:numeroPedido
      },
      success: function (response) {
        if (response.cliente) {
          // Cliente encontrado, exiba os dados na mesma tela
          exibirDadosCliente(response.cliente);
          document.getElementById('mensagem-cliente-nao-encontrado').style.display = 'none';
        }
        else {
            if (response.message) {
              // Cliente encontrado, exiba os dados na mesma tela
              alert('CLIENTE INCOMPATIVEL COM TIPO DO PEDIDO');
              window.location.reload();
            }
            else{
              // Cliente não encontrado, exiba o modal para cadastrar um novo cliente

              document.getElementById('mensagem-cliente-nao-encontrado').style.display = 'block';
              exibirFormularioCadastroCliente(documentoCliente);
              $("#modal-cadastro-cliente").modal("show");
              }
        }
      },
      error: function (xhr, errmsg, err) {
        console.log(xhr.status + ": " + xhr.responseText);
      }
    });
  });

  $("#modal-cadastro-cliente").on("click", "#salvar-cliente", function (event) {
    event.preventDefault(); // Impede o envio do formulário tradicional

    var formData = $("#form-cadastro-cliente").serialize(); // Obtém os dados do formulário

    $.ajax({
      type: "POST",
      url: "/cadastrar_cliente/",
      data: formData,
      success: function (response) {
        // Processar a resposta, se necessário
        // Por exemplo, exibir uma mensagem de sucesso

        // Fechar o modal de cadastro do cliente
        $("#modal-cadastro-cliente").modal("hide");

        // Atualizar os dados na tela de pedido com os dados do cliente cadastrado
        exibirDadosCliente(response.cliente);

        // Remover a mensagem de erro
        document.getElementById('mensagem-cliente-nao-encontrado').style.display = 'none';

        // Executar automaticamente o botão de busca
        buscarCliente();
      },
      error: function (xhr, errmsg, err) {
        console.log(xhr.status + ": " + xhr.responseText);
      }
    });
  });

  $("#fechar-modal").click(function () {
    $("#modal-cadastro-cliente").modal("hide");
  });
});

function exibirDadosCliente(cliente) {
  // Atualizar os campos na tela de pedido com os dados do cliente
  $("#nome_cliente").val(cliente.nome);
  $("#email-cliente").val(cliente.email);
  $("#documento_cliente").val(cliente.documento);
  $("#telefone1-cliente").val(cliente.telefone1);
  $("#telefone2-cliente").val(cliente.telefone2);
  $("#cep-cliente").val(cliente.CEP);
  $("#estado-cliente").val(cliente.estado);
  $("#cidade-cliente").val(cliente.cidade);
  $("#bairro-cliente").val(cliente.bairro);
  $("#endereco-cliente").val(cliente.endereco);
  $("#numero-endereco-cliente").val(cliente.numero_endereco);
  $("#complemento-cliente").val(cliente.complemento);
  $("#dt-abertura").val(cliente.dt_abertura);
  $("#contato-cliente-cnpj").val(cliente.contato_cnpj);
  $("#tipo-cliente").val(cliente.tipo_cliente);
  $("#score-cliente").val(cliente.score_cliente);
  $("#cliente-boleto").val(cliente.boleto);
  $("#ponto-referencia-cliente").val(cliente.ponto_referencia);



  $("#dados-cliente").show();
}

function exibirFormularioCadastroCliente(documento) {
  fetch('/cadastrar_cliente/')
    .then(response => response.text())
    .then(data => {
      // Exiba o formulário de cadastro de cliente na tela
      const formulario = $(data);
      formulario.find('#documento').val(documento); // Define o valor do campo "documento"
      $("#modal-cadastro-cliente .modal-body").html(formulario);
    })
    .catch(error => {
      console.error('Erro ao carregar o formulário de cadastro de cliente:', error);
    });
}
function buscarCliente() {
  var documentoCliente = $("#documento-cliente").val();

  $.ajax({
    type: "GET",
    url: "/get-cliente/",
    data: {
      documento: documentoCliente
    },
    success: function (response) {
      if (response.cliente) {
        // Cliente encontrado, exiba os dados na mesma tela
        exibirDadosCliente(response.cliente);
        document.getElementById('mensagem-cliente-nao-encontrado').style.display = 'none';
      } else {
        // Cliente não encontrado, exiba o modal para cadastrar um novo cliente
        document.getElementById('mensagem-cliente-nao-encontrado').style.display = 'block';
        exibirFormularioCadastroCliente(documentoCliente);
        $("#modal-cadastro-cliente").modal("show");
      }
    },
    error: function (xhr, errmsg, err) {
      console.log(xhr.status + ": " + xhr.responseText);
    }
  });
}
</script>
<!-- SCRIPT PARA INICIALIZAR OS CAMPOS DATA DO PEDIDO  -->
<script>
      // Função para definir a data atual no campo de entrada
      function definirDataAtual() {
        var dataAtual = new Date();
        var ano = dataAtual.getFullYear();
        var mes = ("0" + (dataAtual.getMonth() + 1)).slice(-2);
        var dia = ("0" + dataAtual.getDate()).slice(-2);
        var dataFormatada = ano + "-" + mes + "-" + dia;
        document.getElementById("data-pedido").value = dataFormatada;
      }

      // Chama a função para definir a data atual
      definirDataAtual();













</script>
<!-- SCRIPT PARA MOSTAR OS CAMPOS DE CADASTRAR ENDEREÇO QUANDO O CLIENTE SELECIONA OUTRO ENDEREÇO -->
<script>
    const radio1 = document.getElementById('endereco-cadastro');
    const radio2 = document.getElementById('endereco-opcional');
    const enderecoForm = document.getElementById('enderecoForm');


    radio1.addEventListener('change', () => {
        radio2.checked = false;
        enderecoForm.style.display = 'none';
    });

    radio2.addEventListener('change', () => {
        radio1.checked = false;
         enderecoForm.style.display = 'block';
    });













</script>

<!-- SCRIPT PARA INICIALIZAR OS CAMPOS DATA DE ENTREGA  -->
<script>
    // Função para definir a data atual no campo de data prevista
    function definirDataAtual() {
      var dataAtual = new Date();
      dataAtual.setDate(dataAtual.getDate() + 15);
      var ano = dataAtual.getFullYear();
      var mes = ("0" + (dataAtual.getMonth() + 1)).slice(-2);
      var dia = ("0" + dataAtual.getDate()).slice(-2);
      var dataFormatada = ano + "-" + mes + "-" + dia;
      document.getElementById("data_entrega").value = dataFormatada;
    }

    // Chama a função para definir a data atual
    definirDataAtual();













</script>

<!-- SCRIPT PARA INICIALIZAR O CAMPO DE NUMERO DO PEDIDO  -->
<script>
 $(document).ready(function() {
  var empresa_pedido = $("#empresa-pedido");
  var vendedor = $("#vendedor1");

  var numero_pedido_input = $("#numero_pedido");

  // Function to update the numero_pedido field
  function updateNumeroPedido() {
    $.ajax({
      type: "POST",
      url: "/get-pedidos/",
      data: {
        empresa_pedido: empresa_pedido.val(),
        vendedor: vendedor.val(),
        csrfmiddlewaretoken: '{{ csrf_token }}'
      },
      success: function(response) {
        var numeroPedido = response.numero_pedido;
        numero_pedido_input.val(numeroPedido);
      },
      error: function(xhr, errmsg, err) {
        console.log(xhr.status + ": " + xhr.responseText);
      }
    });
  }

  // Call the function to get the initial numero_pedido on page load
  updateNumeroPedido();

  // Listen for changes to the vendedor1 and empresa_pedido fields
  empresa_pedido.on("change", function() {
    updateNumeroPedido();
  });

  vendedor.on("change", function() {
    updateNumeroPedido();
  });
});
</script>
<!-- ATRIBUI ID A CADA LINHA DO ITEM  -->
<script>
  var csrfToken = '{{ csrf_token }}';
  $(document).ready(function() {
  atribuirNumerosItens();

      $(document).on('click', '#add-row-button', function() {
      var rowCount = $('#tabela-itens tbody tr').length + 1;
      var row = $('tbody tr:last').clone();
      row.find('.item-id').val(rowCount);
      row.find('input').val('');
      $('#tabela-itens tbody').append(row);
      atribuirNumerosItens();
    });
});

function atribuirNumerosItens() {
  var rowCount = $('#tabela-itens tbody tr').length;
  $('#tabela-itens tbody tr').each(function(index) {
    $(this).find('.item-id').val(index + 1);
  });
}




</script>
<!-- SCRIPT PARA CRIAR UMA LISTA DE ITEMS E ACIONAR A VIEW DE SALVAR ITENS COM A LISTA DE PEDIDOS  -->
<script>
$(document).ready(function() {
  $('#submit-button').click(function(e) {
    e.preventDefault();

    var items = [];
    var pedido = $('#numero_pedido').val();
    var tipoPedido = $('#tipo-pedido').val();
    var documento = $('#documento_cliente').val();
    console.log(documento)

    $('#tabela-itens tbody tr').each(function() {
      var item = {
        item_id: $(this).find('.item-id').val(),
        tipo_produto: $(this).find('.tipo_produto').val(),
        quantidade: $(this).find('.quantity').val(),
        produto: $(this).find('.produto').val(),
        comprimento: $(this).find('.item-comprimento').val(),
        largura: $(this).find('.item-largura').val(),
        desconto: parseFloat($(this).find('.desconto-item').val().replace(',', '.').replace(/[^\d.-]/g, '')) || 0,
        preco: parseFloat($(this).find('.unit-price').val().replace(',', '.').replace(/[^\d.-]/g, '')) || 0,
        observacao:  $(this).find('.observacao-item').val()

      };

      items.push(item);
    });

    // Verificar se a lista de itens está vazia
    if (items.length === 0) {
      // Lista vazia, faça o tratamento necessário
      return;
    }

    // Converter a lista de itens em uma string JSON
    var jsonData = JSON.stringify(items);

    // Objeto de dados a ser enviado na requisição AJAX
    var data = {
      items: jsonData,
      tipo_pedido: tipoPedido,
      documento: documento,
      pedido: pedido,
      csrfmiddlewaretoken: '{{ csrf_token }}'  // Adicione o token CSRF aqui, se necessário
    };


    // Fazer a requisição AJAX
    $.ajax({
      type: 'POST',
      url: '/save_itens/',
      data: data,
      dataType: 'json',
      success: function(response) {
        // Lógica para manipular a resposta da view, se necessário
        alert('Itens Salvos');
        $('form').submit();

      },
      error: function(xhr, textStatus, errorThrown) {
        // Trate o erro, se necessário
      },
      complete: function(response) {
        // Verifica se a resposta contém o campo 'erro_valor'
        if (response.responseJSON && response.responseJSON.erro_valor) {
          alert('Um dos valores dos itens não está correto');
          throw new Error('Erro ao processar os itens');
        }
      }
    });
  });
});

</script>
<!-- SCRIPT PARA ATUALIZAR DATA ENTREGA  -->
<script>

   $(document).on('input', '.produto-input', function() {
        var produtoInput = this;
        var row = $(produtoInput).closest('tr');
        var prazoFabricacao = 0;

        // Obtém o prazo de fabricação do produto selecionado
        var produtoSelecionado = row.find('option[value="' + produtoInput.value + '"]');
        if (produtoSelecionado.length) {
            prazoFabricacao = parseInt(produtoSelecionado.data('prazo-fabricacao'));
        }

        // Atualiza a data de entrega com base no prazo de fabricação
        atualizarDataEntrega(prazoFabricacao);
    });

  function atualizarDataEntrega(prazoFabricacao) {
      var dataEntregaInput = document.getElementById('data_entrega');
      var hoje = new Date();
      var prazoFabricacaoDias = parseInt(prazoFabricacao);

      // Calcula a diferença entre a data de entrega e o dia de hoje em milissegundos
      var diffMs = Date.parse(dataEntregaInput.value) - hoje.getTime();

      // Calcula a diferença em dias
      var diffDias = Math.ceil(diffMs / (1000 * 60 * 60 * 24));
      console.log(diffDias);

      // Verifica se o prazo de fabricação é maior ou igual à diferença em dias
      if (prazoFabricacaoDias >= diffDias) {
        // Adiciona o prazo de fabricação aos dias atuais
        var dataEntrega = new Date(hoje.getTime() + prazoFabricacaoDias * 24 * 60 * 60 * 1000);

        // Formata a data para o formato "yyyy-mm-dd"
        var ano = dataEntrega.getFullYear();
        var mes = ('0' + (dataEntrega.getMonth() + 1)).slice(-2);
        var dia = ('0' + dataEntrega.getDate()).slice(-2);
        var dataFormatada = ano + '-' + mes + '-' + dia;

        // Define a data de entrega no campo de entrada
        dataEntregaInput.value = dataFormatada;
      }
  }

</script>

<!-- SCRIPT PARA CALCULAR TOTAL DAS LINHAS E TABELA  -->
<script>
function formatInputValue(input) {
  var value = input.value.trim();

  if (value === "") {
    return;
  }

  value = value.replace(/[^0-9]/g, "");
  value = "R$ " + value.slice(0, -2) + "," + value.slice(-2);

  input.value = value;
}

   $(document).ready(function() {

   $('#total-avista, #total-parcelado, #desconto').on('change', function() {
    updateTotalSum();
  });
  $(document).on("input", ".unit-price, .desconto-item, .acerto, .frete, .total-pagamento1, #total_pg_2, #total_2", function(event) {
  formatInputValue(event.target);
});

  function calculateTotal(row) {
      var quantity = parseInt(row.find('.quantity').val()) || 1;
      var unitPrice = parseFloat(row.find('.unit-price').val().replace(',', '.').replace(/[^\d.-]/g, '')) || 0;
      var discount = parseFloat(row.find('.desconto-item').val().replace(',', '.').replace(/[^\d.-]/g, '')) || 0;
      var total = quantity * unitPrice - discount;
      row.find('.total').text('R$ ' + total.toFixed(2));
      return total;
  }


   function updateTotalSum() {
      var sum = 0;
      $('tbody tr').each(function() {
        var total = calculateTotal($(this));
        sum += total;
      });

      var desconto = parseFloat($('#desconto').val()) || 0;
      var valorTotalPedido = sum - desconto;

      var formattedSum = sum.toFixed(2);
      var formattedValorTotalPedido = valorTotalPedido.toFixed(2);


      $('#total-sum').text('Valor Total: R$ ' + formattedSum);
      $('#pedido-desconto').text('Desconto: R$ ' + desconto.toFixed(2));
      $('#order-total').text('Valor Total do Pedido: R$ ' + formattedValorTotalPedido);
      calcularComissao();
    }

  $(document).on('input','.produto, .item-comprimento, .item-largura, .quantity, .unit-price, .desconto-item', function() {
    var row = $(this).closest('tr');
    calculateTotal(row);
    updateTotalSum();
    calcularComissao();
  });

  $(document).on('click', '.del-row', function() {


    $(this).closest('tr').remove();
    updateTotalSum();
    calcularComissao();


    });

  // Inicializar o valor total ao carregar a página
  updateTotalSum();
});
function calcularComissao() {
  // Obtém os valores dos vendedores
  var vendedor1 = $('#vendedor1').val();
  var vendedor2 = $('#vendedor2').val();
  var cliente = $('#documento_cliente').val();
  var csrftoken = '{{ csrf_token }}';
  var numeroPedido = $("#numero_pedido").val();

  // Obtém os dados da tabela de itens
  var itens = [];
  $('#tabela tbody tr').each(function() {
    var produtoInput = $(this).find('.produto-input');
    var tipoProduto = $(this).find('.tipo_produto');
    var quantityInput = $(this).find('.quantity');
    var comprimentoInput = $(this).find('.item-comprimento');
    var larguraInput = $(this).find('.item-largura');
    var unitPriceInput = $(this).find('.unit-price');

    // Verifica se os campos necessários estão preenchidos
    if (produtoInput.val() && quantityInput.val() && comprimentoInput.val() && larguraInput.val() && unitPriceInput.val()) {
      var item = {
        produto: produtoInput.val(),
        tipo_produto: tipoProduto.val(),
        quantidade: parseInt(quantityInput.val()) || 1,
        comprimento: parseFloat(comprimentoInput.val()) || 0,
        largura: parseFloat(larguraInput.val()) || 0,
        valorUnitario: parseFloat(unitPriceInput.val().replace(',', '.').replace(/[^\d.-]/g, '')) || 0,
        desconto: parseFloat($(this).find('.desconto-item').val().replace(',', '.').replace(/[^\d.-]/g, '')) || 0
      };
      itens.push(item);
    }
  });

  // Verifica se há itens para enviar
  if (itens.length > 0) {
    // Cria o objeto de dados a ser enviado via AJAX
    var dados = {
      numero_pedido: numeroPedido,
      vendedor1: vendedor1,
      vendedor2: vendedor2,
      cliente:cliente,
      itens: itens
    };

    // Faz a solicitação AJAX para a URL do Django
    $.ajax({
      url: '/get-comissao/',
      type: 'POST',
      headers: {
        'X-CSRFToken': csrftoken
      },
      data: JSON.stringify(dados),
      contentType: 'application/json',
      success: function(response) {

        $('#comissao-percentual').text('Comissão: ' + response.comissaoPercentual1 + ' %');
        $('#total-comissao').text('Total Comissão: R$ ' + response.totalComissao1.toFixed(2));
        $('#comissao-percentual-2').text('Comissão: ' + response.comissaoPercentual2 + ' %');
        $('#total-comissao-2').text('Total Comissão: R$ ' + response.totalComissao2.toFixed(2));
      },
      error: function(error) {
        // Lida com erros da solicitação AJAX
        console.error(error);
      }
    });
  } else {
    // Campos necessários não preenchidos, faça algo aqui (exibir mensagem de erro, etc.)

  }
}




</script>
<!-- SCRIPT PARA EXIBIR DETALHES DE PAGAMENTO - 1ª FORMA DE PAGAMENTO  -->
<script>
var momentoPagamentoSelect = document.getElementById("momento-pagamento-1");
var detalhesFaturamentoRow = document.getElementById("row-detalhes-faturamento");
var formaPagamentoSelect = document.getElementById("forma-pgto-1");
var detalhesAntecipadoRow = document.getElementById("data-pagamento-antecipado");



// Adiciona o evento de mudança ao campo de seleção
momentoPagamentoSelect.addEventListener("change", function() {

    var clienteBoleto = document.getElementById("cliente-boleto");
    console.log(clienteBoleto);


  if ((clienteBoleto.value === "SIM")&&(momentoPagamentoSelect.value === "FATURADO"))  {
    // Mostra o elemento
    detalhesFaturamentoRow.style.display = "block";
    formaPagamentoSelect.value="BOLETO";
    detalhesAntecipadoRow.style.display = "none";

  }
  else {
    if ((clienteBoleto.value === "NAO")&&(momentoPagamentoSelect.value === "FATURADO"))  {
        // Mostra o elemento
        alert("Cliente Não Habilitado Para Faturamento");
        momentoPagamentoSelect.value = "ANTECIPADO";
        detalhesFaturamentoRow.style.display = "none";
        detalhesAntecipadoRow.style.display = "block";
    }
   else{
    detalhesFaturamentoRow.style.display = "none";
    }
    }

});

</script>
<script>
var formaPagamentoSelect = document.getElementById("forma-pgto-1");
var detalhesDivParcela = document.getElementById("pagamento-parcelado");
var totalPagamento1 = document.getElementById("total_pagamento_1");

// Adiciona o evento de mudança ao campo de seleção
formaPagamentoSelect.addEventListener("change", function() {
  // Verifica o valor selecionado
  if (formaPagamentoSelect.value === "CARTAO CREDITO") {
    // Mostra o elemento
    detalhesDivParcela.style.display = "block";
    totalPagamento1.style.display= "none";
  } else {
    // Oculta o elemento
    detalhesDivParcela.style.display = "none";
    totalPagamento1.style.display= "block";
  }
});
</script>
<!-- SCRIPT PARA EXIBIR DETALHES DE PAGAMENTO - 2ª FORMA DE PAGAMENTO  -->
<script>
var formaPagamento2Select = document.getElementById("forma-pgto-2");
var detalhesDivParcela2 = document.getElementById("pagamento-parcelado-2");
var totalPagamento2 = document.getElementById("total_pagamento_2");


// Adiciona o evento de mudança ao campo de seleção
formaPagamento2Select.addEventListener("change", function() {
  // Verifica o valor selecionado
  if (formaPagamento2Select.value === "CARTAO CREDITO") {
    // Mostra o elemento
    detalhesDivParcela2.style.display = "block";
    totalPagamento2.style.display= "none";
  } else {
    // Oculta o elemento
    detalhesDivParcela2.style.display = "none";
    totalPagamento2.style.display= "block";
  }
});
</script>
<script>
var momento2PagamentoSelect = document.getElementById("momento-pagamento_2");
var detalhes2FaturamentoRow = document.getElementById("row-detalhes-faturamento-2");
var formaPagamento2Select = document.getElementById("forma-pgto-2");
// Adiciona o evento de mudança ao campo de seleção
momento2PagamentoSelect.addEventListener("change", function() {
    var cliente2Boleto = document.getElementById("cliente-boleto");

   if ((cliente2Boleto.value === "SIM")&&(momento2PagamentoSelect.value === "FATURADO"))  {
    // Mostra o elemento
    detalhes2FaturamentoRow.style.display = "block";
    formaPagamento2Select.value="BOLETO";

  }
  else {
    if ((cliente2Boleto.value === "NAO")&&(momento2PagamentoSelect.value === "FATURADO"))  {
        // Mostra o elemento
        alert("Cliente Não Habilitado Para Faturamento");
        momento2PagamentoSelect.value = "ANTECIPADO";
        detalhes2FaturamentoRow.style.display = "none";
    }
   else{
    detalhes2FaturamentoRow.style.display = "none";
    }
    }

});

</script>
<!-- SCRIPT PARA FORMATAR CAMPOS DE MEDIDAS C/ 3 CASAS DECIMAIS  -->
<script>
  function formatInput2Value(input) {
  var value = input.value.trim();

  if (value === "") {
    return;
  }

  value = value.replace(/[^0-9]/g, "");
  value = value.slice(0, -3) + "." + value.slice(-3);

  input.value = value;
}

// Adiciona o evento de digitação aos campos de largura ou comprimento existentes
document.addEventListener("keyup", function(event) {
  var target = event.target;

  if (target.classList.contains("item-comprimento") || target.classList.contains("item-largura")) {
    formatInput2Value(target);
  }
});

</script>
<!-- SCRIPT PARA FORMATAR CAMPOS DE VALOR C/2 CASAS DECIMAIS
<script>
  function formatInputValue(input) {
  var value = input.value.trim();

  if (value === "") {
    return;
  }

  value = value.replace(/[^0-9]/g, "");
  value = value.slice(0, -2) + "." + value.slice(-2);

  input.value = value;
}

// Adiciona o evento de digitação aos campos de largura ou comprimento existentes
document.addEventListener("keyup", function(event) {
  var target = event.target;

  if (target.classList.contains("unit-price")|| target.classList.contains("desconto-item")) {
    formatInputValue(target);
  }
});

</script> -->

<script>
  $(document).ready(function() {
  $('#total-parcelas, #total_pagamento1').on('input', function() {
    var totalParcelas = parseFloat($('#total-parcelas').val()) || 0;
    var totalPagamento = parseFloat($('#total_pagamento1').val().replace(',', '.').replace(/[^\d.-]/g, '')) || 0;

    if (totalParcelas > 0 && totalPagamento > 0) {
      var valorParcelas = totalPagamento / totalParcelas;
      $('#valor-parcelas').val(valorParcelas.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL', minimumFractionDigits: 2 }));
    }

  });
});
</script>
<script>
  $(document).ready(function() {
  $('#total-parcelas-2, #total_pg_2').on('input', function() {
    var totalParcelas2 = parseFloat($('#total-parcelas-2').val()) || 0;
    var totalPagamento2 = parseFloat($('#total_pg_2').val().replace(',', '.').replace(/[^\d.-]/g, '')) || 0;

    if (totalParcelas2 > 0 && totalPagamento2 > 0) {
      var valorParcelas2 = totalPagamento2 / totalParcelas2;
      $('#valor-parcelas-2').val(valorParcelas2.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL', minimumFractionDigits: 2 }));
    }

  });
});
</script>

</body>

</html>
{% endblock %}