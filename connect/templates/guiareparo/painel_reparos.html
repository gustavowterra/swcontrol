{% extends 'modelo.html' %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>

</head>
<body>
{% block container %}

<div class="modal" id="modal-informacoes-nfe" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Emissão de NFE</h5>
                <button type="button" class="close" data-dismiss="modal" id="fechar-modal-nfe" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <!-- Conteúdo do formulário de cadastro de layout -->
                <form method="post" enctype="multipart/form-data" id="modal-nfe-form">
                    {% csrf_token %}
                    <div class="form-group">
                        <label for="numero_pedido">Número do Pedido</label>
                        <input type="text" class="form-control" id="numero_pedido_nf" name="numero_pedido_nf">
                    </div>
                    <div class="form-group">
                        <label for="informacoes_complementares">Informações Adicionais</label>
                        <input type="text" class="form-control" id="informacoes_complementares"
                               name="informacoes_complementares">
                    </div>
                    <div class="form-group">
                        <label for="inscricao">Inscricao Estadual</label>
                        <input type="text" class="form-control" id="inscricao" name="inscricao">
                    </div>
                    <button type="submit" id="emitir-notafiscal-btn" class="btn btn-dark mt-2">Emitir NFe</button>
                </form>

            </div>
        </div>
    </div>
</div>

<div class="modal" id="modal-pendente-financeiro" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Informações Pedido</h5>
                <button type="button" class="close" data-dismiss="modal" id="fechar-modal-pf" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <!-- Conteúdo do formulário de cadastro de layout -->
                <form method="post" enctype="multipart/form-data" id="modal-pf-form">
                    {% csrf_token %}
                    <div class="form-group">
                        <label for="numero_pedido_pf" style="font-weight: bold;">Número do Pedido</label>
                        <input type="text" class="form-control text-dark" id="numero_pedido_pf" name="numero_pedido_pf"
                               style="border-style: solid; border-width: 2px; border-color: black; padding-left: 5px;"
                               readonly>
                    </div>
                    <div class="form-group mt-3">
                        <label for="data-pa" style="font-weight: bold;">Data Pagamento Antecipado</label>
                        <input type="date" class="form-control" id="data-pa" name="data_pa"
                               style="padding-left: 5px; border-style: solid; border-width: 2px; border-color: black;">
                    </div>
                    <div class="form-group mt-3">
                        <label for="data-pa" style="font-weight: bold;">Banco</label>
                        <select class="form-control" id="banco-pa" name="banco_pa"
                                style="padding-left: 5px; border-style: solid; border-width: 2px; border-color: black;">

                            <option value="BRADESCO">BRADESCO</option>
                            <option value="SANTANDER">SANTANDER</option>
                            <option value="PAGBANK">PAGBANK</option>
                            <option value="ITAU">ITAU</option>


                        </select>
                    </div>
                    <div class="form-group mt-3">
                        <label for="empresa-pa" style="font-weight: bold;">Empresas</label>
                        <select class="form-control" id="empresa-pa" name="empresa-pa"
                                style="padding-left: 5px; border-style: solid; border-width: 2px; border-color: black;">
                            {% for empresa in empresas %}
                            <option value="{{empresa.nome}}">{{empresa.nome}}</option>
                            {% endfor %}

                        </select>
                    </div>
                    <div class="form-group mt-3">
                        <label for="valor-pa" style="font-weight: bold;">Valor Antecipado</label>
                        <input type="text" class="form-control" id="valor-pa" name="valor_pa"
                               style="padding-left: 5px; border-style: solid; border-width: 2px; border-color: black;">
                    </div>
                    <button type="submit" id="atualizar-pedido" class="btn btn-dark mt-2">Confirmar Pagamento</button>
                </form>

            </div>
        </div>
    </div>
</div>

<div class="modal" id="modal-status-pedidos" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Alteração de Status</h5>
                <button type="button" class="close" data-dismiss="modal" id="fechar-modal-status" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">

                <form method="post" enctype="multipart/form-data" id="modal-status-form">
                    {% csrf_token %}
                    <div class="form-group">
                        <label for="codigo_orcamento">Codigo do Orçamento</label>
                        <input type="text" class="form-control" id="codigo_orcamento" name="codigo_orcamento">
                    </div>
                    <div class="form-group">
                        <label for="status_orcamento">Novo Status do Orçamento</label>
                        <select id="status_orcamento" name="status_orcamentoo" class="form-control">

                            {% for s in status %}
                            <option value="{{ s.id }}">{{ s.descricao }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <button type="submit" id="edita-status-btn" class="btn btn-dark mt-2">Salvar</button>
                </form>

            </div>
        </div>
    </div>
</div>

<div class="modal" id="modal-cadastro-layout" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Cadastro de Layout</h5>
                <button type="button" class="close" data-dismiss="modal" id="fechar-modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <!-- Conteúdo do formulário de cadastro de layout -->
                <form method="post" enctype="multipart/form-data" action="/cadastrar_layout/" id="modal-form">
                    {% csrf_token %}
                    <div class="form-group">
                        <label for="numero_pedido">Número do Pedido</label>
                        <input type="text" class="form-control" id="numero_pedido" name="numero_pedido">
                    </div>
                    <div class="form-group">
                        <label for="arquivo">Escolha o Arquivo</label>
                        <input type="file" class="form-control" id="arquivo" name="arquivo">
                    </div>
                    <button type="submit" id="cadastrar-pedido-btn" class="btn btn-dark">Salvar Arquivo</button>
                </form>
                <div id="mensagem-sucesso" class="d-none text-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon" viewBox="0 0 16 16" fill="#155724">
                        <path d="M2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2zm10.03 4.97a.75.75 0 0 1 .011 1.05l-3.992 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425a.75.75 0 0 1 1.08-.022z"/>
                    </svg>
                    <span>LAYOUT CADASTRADO COM SUCESSO</span>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal" id="modal-transporte" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Cadastro Transportadora NFe</h5>
                <button type="button" class="close" data-dismiss="modal" id="fechar-modal-transporte"
                        aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <!-- Conteúdo do formulário de cadastro de Frete -->
                <form method="post" enctype="multipart/form-data" id="modal-transporte-form">
                    {% csrf_token %}
                    <div class="form-group">
                        <label for="numero_pedido">Número do Pedido</label>
                        <input type="text" class="form-control" id="numero_pedido_transporte" name="pedido_transporte"
                               readonly>
                    </div>
                    <div class="form-group col-md-6">

                        <label for="select-transportadora">Transportadora</label>
                        <div class="d-flex align-items-center ">
                            <select type="text" class="form-control col-md-6" id="select-transportadora"
                                    name="transportadora">
                                {% for frete in fretes %}
                                <option value="{{ frete.nome }}">{{ frete.nome }}</option>
                                {% endfor %}
                            </select>
                            <a href="/cadastrar_fornecedor/" class="col md-3 btn sm-btn-primary text-end">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                     class="bi bi-plus-circle-fill" viewBox="0 0 16 16">
                                    <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM8.5 4.5a.5.5 0 0 0-1 0v3h-3a.5.5 0 0 0 0 1h3v3a.5.5 0 0 0 1 0v-3h3a.5.5 0 0 0 0-1h-3v-3z"/>
                                </svg>
                            </a>

                        </div>
                    </div>
                    <div class="form-group">
                        <label for="valor-frete">Valor do Frete</label>
                        <input type="text" class="form-control" id="valor-frete" name="valor_frete" value="0.00">
                        <label for="valor-frete">Peso</label>
                        <input type="text" class="form-control" id="peso-frete" name="peso_frete" value="0.00">
                        <label for="volumes-frete">Volumes</label>
                        <input type="text" class="form-control" id="volumes-frete" name="volumes_frete" value="0.00">
                        <label for="valor-frete">Adicionar no Contas a Pagar</label>
                        <select class="form-control" id="opcao-conta-pagar" name="conta-pagar">
                            <option value="sim">SIM</option>
                            <option value="nao" selected>NAO</option>
                        </select>
                    </div>


                    <button type="submit" id="cadastrar-transporte-btn" class="btn btn-dark mt-2">Salvar</button>
                </form>

            </div>
        </div>
    </div>
</div>

<div class="modal" id="modal-comentario" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Comentar</h5>
                <button type="button" class="close" data-dismiss="modal" id="fechar-modal-comentario"
                        aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">

                <form method="post" enctype="multipart/form-data" id="modal-comentario-form">
                    {% csrf_token %}
                    <div class="form-group">
                        <label for="numero_orcamento">Número do Orçamento</label>
                        <input type="text" class="form-control" id="numero_orcamento" name="numero_orcamento">
                    </div>
                    <div class="form-group">
                        <label for="novo_comentario">Seu Comentário:</label>
                        <textarea id="novo_comentario" maxlength="255" class="form-control" required>

                                                    </textarea>

                    </div>
                    <button type="submit" id="envia-comentario-btn" class="btn btn-dark mt-2">Enviar</button>
                </form>

            </div>
        </div>
    </div>
</div>

<div class="modal" id="modal-comentarios-report" tabindex="-1" role="dialog" aria-hidden="true">

    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Comentários</h5>
                <button type="button" class="close" data-dismiss="modal" id="fechar-modal-comentarios-report"
                        aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <iframe id="observacoes-iframe" width="100%" height="400px" style="border: none;"></iframe>
            </div>


        </div>
    </div>
</div>


<div class="row" style="display:none;">
    <div class="container"
         style="display: flex;  justify-content: space-around; align-items: center; height: 20vh; adding: 20px; box-sizing: border-box;">
        <div class="card"
             style="background-color: #008080; width: 30%; padding: 20px;box-shadow: 0 20px 40px rgba(0, 0, 0,  0.5); border-radius: 8px; box-sizing: border-box;">
            <h1 class="text-center text-white"><strong>{{ total_orcamentos_mes }}</strong></h1>
            <i class=" text-end text-white">Total de Guias de Reparo</i>
        </div>
        <div class="card"
             style="background-color: #4169E1; width: 30%; padding: 20px; box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5); border-radius: 8px; box-sizing: border-box;">
            <h1 class="text-center text-white"><strong>{{ total_acima_mil }}</strong></h1>
            <i class=" text-end text-white">Total Acima de R$ 1000,00</i>
        </div>
        <div class="card"
             style="background-color: #B22222; width: 30%; padding: 20px; box-shadow: 0 20px 40px rgba(0, 0, 0,  0.5); border-radius: 8px; box-sizing: border-box;">
            <h1 class="text-center text-white"><strong>{{ total_sem_atualizacao }}</strong></h1>
            <i class=" text-end text-white">Orçamentos Faltando Atualizar</i>
        </div>


    </div>

</div>


<div class="card" style="display: flex; width: 98%; padding:20px; margin-top:20px; margin: 20px auto;">
    <div>
        <h4 style="margin-top: 20px; color:#008080 "> Painel - Guias de Reparo </h4>

    </div>
    <table class="table table-striped table tablesorter table-responsive" id="ipi-table" style="margin-top:20px; ">
        <thead class="thead-dark" style="margin-top: 20px;">
         <tr style="margin-top: 20px; background:#008080; text-color:white; font-color:white; border-style: none;">
                <th class="text-center text-white">Pedido / Vendedor</th>
                <th class="text-center text-white">Status</th>
                <th class="text-center text-white">Cliente</th>
                <th class="text-center text-white">Observação</th>
                <th class="text-center text-white">Data Criação</th>
                <th class="text-center text-white">Data Alteração</th>
                <th class="text-center text-white">Ações</th>
            </tr>
        </thead>
       <tbody class="text-center" style="font-size:80%">
            <!-- Supondo que os dados são renderizados dinamicamente -->
            {% for guia in guias %}
            <tr>
                <td  style="color: var(--bs-gray-800); background: var(--bs-white); white-space: normal;">{{ guia.codigo }} {{guia.pedido.Vendedor}}</td>
                <td  style="color: var(--bs-gray-800); background: var(--bs-white); white-space: normal;">

                   {% if guia.status.descricao == 'Expedicao Reparo' %}
                    <button class="btn bg-gradient-danger text-xxs font-weight"
                            style="color: white; background-color: #FF4500; font-size: 10px; font-weight: bold;">
                        {{ guia.status.descricao }}
                    </button>
                    {% elif guia.status.descricao == 'Em Coleta Reparo' %}
                     <button class="btn bg-gradient-danger text-xxs font-weight"
                            style="color: white; background-color: #DB7093; font-size: 10px; font-weight: bold;">
                        {{ guia.status.descricao }}
                    </button>
                     {% elif guia.status.descricao == 'Producao Reparo' %}
                     <button class="btn bg-gradient-danger text-xxs font-weight"
                            style="color: white; background-color: #8B008B; font-size: 10px; font-weight: bold;">
                        {{ guia.status.descricao }}
                    </button>
                    {% elif guia.status.descricao == 'Expedicao Reparo Concluido' %}
                     <button class="btn bg-gradient-danger text-xxs font-weight"
                            style="color: white; background-color: #00FF00; font-size: 10px; font-weight: bold;">
                        {{ guia.status.descricao }}
                    </button>
                    {% elif guia.status.descricao == 'Reparo Rota de Entrega' %}
                     <button class="btn bg-gradient-danger text-xxs font-weight"
                            style="color: white; background-color:#008080; font-size: 10px; font-weight: bold;">
                        {{ guia.status.descricao }}
                    </button>
                    {% elif guia.status.descricao == 'Reparo Entregue' %}
                     <button class="btn bg-gradient-danger text-xxs font-weight"
                            style="background-color:#DCDCDC; font-size: 10px; font-weight: bold;">
                        {{ guia.status.descricao }}
                    </button>

                    {% endif %}
                   </td>
                <td  style="color: var(--bs-gray-800); background: var(--bs-white); white-space: normal;">{{ guia.pedido.cliente_pedido.nome }}</td>
                <td  style="color: var(--bs-gray-800); background: var(--bs-white); white-space: normal;">{{ guia.observacao|default:"" }}</td>
                <td  style="color: var(--bs-gray-800); background: var(--bs-white); white-space: normal;">{{ guia.data_criacao|date:'d/m/y' }}</td>
                <td  style="color: var(--bs-gray-800); background: var(--bs-white); white-space: normal;">{{ guia.data_alteracao|date:'d/m/y' }}</td>

                <td  style="color: var(--bs-gray-800); background: var(--bs-white); white-space: normal;">
                    <a  onclick="toggleSubTable('subtable-{{ guia.id }}')" role="button" class="btn" title="{{ guia.codigo }}" style="background:#008080; color: white; font-size:12px;">Detalhes </a>
                     <a role="button" href="/guia_reparo_documento/{{guia.codigo}}/" class="btn" title="Gerar Documento" style="background:#008080; color: white; font-size:12px;">
                         <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                              class="bi bi-filetype-pdf" viewBox="0 0 16 16">
                             <path fill-rule="evenodd"
                                   d="M14 4.5V14a2 2 0 0 1-2 2h-1v-1h1a1 1 0 0 0 1-1V4.5h-2A1.5 1.5 0 0 1 9.5 3V1H4a1 1 0 0 0-1 1v9H2V2a2 2 0 0 1 2-2h5.5zM1.6 11.85H0v3.999h.791v-1.342h.803q.43 0 .732-.173.305-.175.463-.474a1.4 1.4 0 0 0 .161-.677q0-.375-.158-.677a1.2 1.2 0 0 0-.46-.477q-.3-.18-.732-.179m.545 1.333a.8.8 0 0 1-.085.38.57.57 0 0 1-.238.241.8.8 0 0 1-.375.082H.788V12.48h.66q.327 0 .512.181.185.183.185.522m1.217-1.333v3.999h1.46q.602 0 .998-.237a1.45 1.45 0 0 0 .595-.689q.196-.45.196-1.084 0-.63-.196-1.075a1.43 1.43 0 0 0-.589-.68q-.396-.234-1.005-.234zm.791.645h.563q.371 0 .609.152a.9.9 0 0 1 .354.454q.118.302.118.753a2.3 2.3 0 0 1-.068.592 1.1 1.1 0 0 1-.196.422.8.8 0 0 1-.334.252 1.3 1.3 0 0 1-.483.082h-.563zm3.743 1.763v1.591h-.79V11.85h2.548v.653H7.896v1.117h1.606v.638z"/>
                         </svg>
                     </a>
                    <a role="button" class="btn btn-delete-guia" data-guia="{{ guia.id }}" title="Excluir Guia {{guia.codigo}}" style="background:#008080; color: white; font-size:12px;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                             class="bi bi-file-earmark-x-fill" viewBox="0 0 16 16">
                            <path d="M9.293 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V4.707A1 1 0 0 0 13.707 4L10 .293A1 1 0 0 0 9.293 0M9.5 3.5v-2l3 3h-2a1 1 0 0 1-1-1M6.854 7.146 8 8.293l1.146-1.147a.5.5 0 1 1 .708.708L8.707 9l1.147 1.146a.5.5 0 0 1-.708.708L8 9.707l-1.146 1.147a.5.5 0 0 1-.708-.708L7.293 9 6.146 7.854a.5.5 0 1 1 .708-.708"/>
                        </svg>
                     </a>
                </td>
            </tr>
             <tr id="subtable-{{ guia.id }}" class="sub-tabela" style="display:none;">
                <td colspan="7">
                    <table border="2" width="100%">
                        <thead>
                            <tr style="margin-top: 20px; background:#008080; text-color:white; font-color:white; border-style: none;">
                                <th class="text-center text-white">ID</th>
                                <th class="text-center text-white">Nome Item</th>
                                <th class="text-center text-white">Observação</th>

                            </tr>
                        </thead>
                        <tbody class="text-center" style="font-size:80%">
                            {% for reparo in guia.reparos_set.all %}
                            <tr>
                                <td style="background: var(--bs-white); white-space: normal;">{{ reparo.id }}</td>
                                <td style="background: var(--bs-white); white-space: normal;">{{ reparo.item.nome }} - Comprimento: {{ reparo.item.comprimento }} x  Largura: {{ reparo.item.largura }}</td>
                                <td style="background: var(--bs-white); white-space: normal;">{{ reparo.observacao }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

</div>


<!-- DataTables CSS -->
<link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css">

<!-- jQuery e DataTables JS -->
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>



<script>
        function toggleSubTable(id) {
            const subTable = document.getElementById(id);
            subTable.style.display = subTable.style.display === "none" ? "table-row" : "none";
        }
    </script>
<!--DELETAR PEDIDO -->
<script>

    var btnDelete = document.querySelectorAll('.btn-delete-guia');
    btnDelete.forEach(function(btn) {
        btn.addEventListener('click', function() {
            var idGuia = this.getAttribute('data-guia');
            var confirmDelete = confirm("Tem certeza que deseja prosseguir com a exclusão da Guia?");

            if (confirmDelete) {
                var id_guia = idGuia;
                var url = "/delete_guia/";

                var xhr = new XMLHttpRequest();
                xhr.open("POST", url, true);
                xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");

                // Obtém o token CSRF do cookie e adiciona na requisição
                var csrfToken = getCookie('csrftoken');
                xhr.setRequestHeader("X-CSRFToken", csrfToken);

                xhr.onreadystatechange = function() {
                    if (xhr.readyState === 4 && xhr.status === 200) {
                        var response = JSON.parse(xhr.responseText);
                        alert(response.mensagem);
                        window.location.reload();
                    } else if (xhr.readyState === 4 && xhr.status !== 200) {
                        alert("Falha ao excluir a Guia.");
                    }
                };
                xhr.send("id_guia=" + id_guia);
            } else {
                // Exclusão do pedido cancelada
                alert("Exclusão da Guia cancelada.");
                event.preventDefault(); // Impede o envio do formulário
            }
        });
    });
    function getCookie(name) {
    var cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        var cookies = document.cookie.split(';');
        for (var i = 0; i < cookies.length; i++) {
            var cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

</script>

<script>
    var btnsUploadLayout = document.querySelectorAll('[id^="btn-upload-layout-"]');

    for (var i = 0; i < btnsUploadLayout.length; i++) {
        btnsUploadLayout[i].addEventListener('click', function(event) {
            event.preventDefault();
            var numeroPedido = this.getAttribute('data-pedido');
            document.getElementById('numero_pedido').value = numeroPedido;
            document.getElementById('modal-cadastro-layout').style.display = 'block';
        });
    }

    document.getElementById('fechar-modal').addEventListener('click', function(event) {
        event.preventDefault();
        document.getElementById('modal-cadastro-layout').style.display = 'none';
    });
    document.getElementById('cadastrar-pedido-btn').addEventListener('click', function(event) {
        event.preventDefault();
        document.getElementById('modal-form').submit();
    });

</script>
<script>
var btnsGravarFrete = document.querySelectorAll('.btn-transporte');

// Itera sobre os botões encontrados
btnsGravarFrete.forEach(function(btns) {
  btns.addEventListener('click', function() {
    console.log('entrou clique');
    // Obtém o número do pedido do atributo de dados 'data-pedido'
    var numeroPedido = this.getAttribute('data-pedido');
    var freteFlag = this.getAttribute('data-frete');
    document.getElementById('numero_pedido_transporte').value = numeroPedido;
    document.getElementById('modal-transporte').style.display = 'block';

    document.getElementById('modal-transporte-form').addEventListener('submit', function(event) {
      // Impede o comportamento padrão de submissão do formulário
      event.preventDefault();
      var transportadora = document.getElementById('select-transportadora').value;
      var numeroPedidoNF = document.getElementById('numero_pedido_transporte').value;
      var valorFrete = document.getElementById('valor-frete').value;
      var peso = document.getElementById('peso-frete').value;
      var volumes = document.getElementById('volumes-frete').value;
      var opcaoContaPagar = document.getElementById('opcao-conta-pagar').value;

      document.getElementById('modal-transporte').style.display = 'none';


    // Cria um objeto de dados para enviar na requisição
    var data = {
      numero_pedido: numeroPedido,
      transportadora: transportadora,
      valor_frete: valorFrete,
      volumes: volumes,
      peso: peso,
      conta_pagar: opcaoContaPagar
    };

    // Faz a requisição para a view 'emitir_nota' usando fetch
    fetch('/cadastrar-transportadora/', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-CSRFToken': '{{ csrf_token }}'
      },
      body: JSON.stringify(data)
    })
    .then(function(response) {
      if (response.ok) {
        // Manipule a resposta da requisição conforme necessário
        alert('Pedido Atualizado Com Sucesso!');
        window.location.reload();
        return response.json();
      } else {
        alert('Ocorreu um erro: Favor contactar o suporte');
      }
    })
    .then(data => {
        // Lógica de tratamento da resposta, se necessário

    })
    .then(function(responseData) {
       if (responseData.error) {
        // Realize as ações necessárias para tratar o erro
        alert('Erro: ' + responseData.error);
      }else{
      console.log(responseData); }
      // Realize as ações necessárias com os dados da resposta
    })
    .catch(function(error) {
      console.error('Erro: ' + error.message);
    });
    });
  });
});
document.getElementById('fechar-modal-transporte').addEventListener('click', function() {
  document.getElementById('modal-transporte').style.display = 'none';
});

</script>
<script>
    // Obtém referência ao botão e à div
    const botaoFiltrar = document.getElementById('botao-filtrar');
    const rowForm = document.getElementById('row-form');

    // Adiciona o manipulador de evento ao botão
    botaoFiltrar.addEventListener('click', function() {
        // Verifica o status de exibição atual da div
        const displayStatus = rowForm.style.display;

        // Altera o status de exibição com base no status atual
        if (displayStatus === 'none') {
            rowForm.style.display = 'block';
        } else {
            rowForm.style.display = 'none';
        }
    });


</script>
<script>
var btnsEmitirNF = document.querySelectorAll('.btn-emitir-nf');

// Itera sobre os botões encontrados
btnsEmitirNF.forEach(function(btn) {
  btn.addEventListener('click', function() {
    // Obtém o número do pedido do atributo de dados 'data-pedido'
    var numeroPedido = this.getAttribute('data-pedido');
    var inscricao = this.getAttribute('data-inscricao');
    document.getElementById('numero_pedido_nf').value = numeroPedido;
    document.getElementById('inscricao').value = inscricao;
    document.getElementById('modal-informacoes-nfe').style.display = 'block';

    document.getElementById('modal-nfe-form').addEventListener('submit', function(event) {
      // Impede o comportamento padrão de submissão do formulário
      event.preventDefault();
      var informacoesComplementares = document.getElementById('informacoes_complementares').value;
      var numeroPedidoNF = document.getElementById('numero_pedido_nf').value;
      var inscricao = document.getElementById('inscricao').value;



    // Cria um objeto de dados para enviar na requisição
    var data = {
      numero_pedido: numeroPedido,
      inscricao: inscricao,
      informacoes_complementares: informacoesComplementares
    };

    // Faz a requisição para a view 'emitir_nota' usando fetch
    fetch('/emitir-nota/', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-CSRFToken': '{{ csrf_token }}'
      },
      body: JSON.stringify(data)
    })
    .then(function(response) {
      if (response.ok) {
        // Manipule a resposta da requisição conforme necessário
        return response.json();
      } else {
        throw new Error('Erro na requisição: ' + response.statusText);
      }
    })
    .then(data => {
        // Lógica de tratamento da resposta, se necessário
        console.log(data);

        // Verifique se existe a propriedade 'bankSlipUrl' no JSON de resposta
        if (data && data.hasOwnProperty('nfe')) {
            // Redirecione a página para a URL do PDF do boleto
            console.log(data.nfe);
            window.open(data.nfe, '_blank');

        }else if (data && data.hasOwnProperty('error')) {
            // Exiba a mensagem de erro em um alert
            alert('Erro: ' + data.error);
          } else {
            // Lógica de tratamento da resposta, se necessário
            console.log(data);
           }
    })
    .then(function(responseData) {
       if (responseData.error) {
        // Realize as ações necessárias para tratar o erro
        alert('Erro: ' + responseData.error);
      }else{
      console.log(responseData); }
      // Realize as ações necessárias com os dados da resposta
    })
        // ...
    .catch(function(error) {
      console.error('Erro: ' + error.message);
      if (error) {
        try {
          var errorResponse = JSON.parse(error.response);
          var errorMessage = errorResponse.mensagem;
          alert('Erro: ' + errorMessage);
        } catch (e) {
          alert('Erro na requisição: ' + error.message);
        }
      } else {
        alert('Erro na requisição: ' + error.message);
      }
    });

    });
  });
});
document.getElementById('fechar-modal-nfe').addEventListener('click', function() {
  document.getElementById('modal-informacoes-nfe').style.display = 'none';
});




</script>
<script>
var btnsCancelarNF = document.querySelectorAll('.btn-cancelar-nfe');

// Itera sobre os botões encontrados
btnsCancelarNF.forEach(function(btn) {
  btn.addEventListener('click', function() {
    // Obtém o número do pedido do atributo de dados 'data-pedido'
    var confirmDelete = confirm("Tem certeza que deseja prosseguir com a exclusão da Nota Fiscal?");
    var numeroPedidoNF = this.getAttribute('data-cancela-pedido');
    console.log(numeroPedidoNF);
    if (confirmDelete){
        // Cria um objeto de dados para enviar na requisição
        var data = {
          numero_pedido: numeroPedidoNF
        };

        // Faz a requisição para a view 'emitir_nota' usando fetch
        fetch('/cancelar-nota/', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': '{{ csrf_token }}'
          },
          body: JSON.stringify(data)
        })
        .then(function(response) {
          if (response.ok) {
            alert("Nota Fiscal Cancelada com Sucesso!!!");
            window.location.reload();

            return response.json();
          } else {
            throw new Error('Erro na requisição: ' + response.statusText);
          }
        })
        .then(data => {
            // Lógica de tratamento da resposta, se necessário
            console.log(data);

            // Verifique se existe a propriedade 'bankSlipUrl' no JSON de resposta

        })
        .then(function(responseData) {
           if (responseData.error) {
            // Realize as ações necessárias para tratar o erro
            alert('Erro: ' + responseData.error);
          }else{
            console.log(responseData);
            alert(responseData);}
          // Realize as ações necessárias com os dados da resposta
        })
        .catch(function(error) {
          console.error('Erro: ' + error.message);
        });
     }
  });
});





</script>
<script>
// Função para formatar o valor em moeda brasileira (R$)
function formatarMoeda(valor) {
  return valor.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
}

// Seleciona todos os elementos da tabela com a classe 'valor-total'
var elementosValorTotal = document.querySelectorAll('.valor-total');

// Percorre os elementos e formata o valor em moeda brasileira
elementosValorTotal.forEach(function(elemento) {
  var valor = parseFloat(elemento.textContent.replace(',', '.'));
  if (!isNaN(valor)) {
    elemento.textContent = formatarMoeda(valor);
  }
});

</script>

<script>
var btnStatus = document.querySelectorAll('.btn-altera-status');

// Itera sobre os botões encontrados
btnStatus.forEach(function(btn) {
  btn.addEventListener('click', function() {
    // Obtém o número do pedido do atributo de dados 'data-pedido-status'
    var numeroOrcamento = this.getAttribute('data-orcamento');
    var status = this.getAttribute('data-status');

    document.getElementById('codigo_orcamento').value = numeroOrcamento;
    document.getElementById('status_orcamento').value = status;

    document.getElementById('modal-status-pedidos').style.display = 'block';

    document.getElementById('modal-status-form').addEventListener('submit', function(event) {
      // Impede o comportamento padrão de submissão do formulário
      event.preventDefault();
      var status = document.getElementById('status_orcamento').value;

      var orcamento_codigo = document.getElementById('codigo_orcamento').value;

    console.log(status);


    // Cria um objeto de dados para enviar na requisição
    var data = {
      orcamento_codigo: orcamento_codigo,

      status: status
    };

    // Faz a requisição para a view 'emitir_nota' usando fetch
    fetch('/atualiza-status-orcamento/', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-CSRFToken': '{{ csrf_token }}'
      },
      body: JSON.stringify(data)
    })
    .then(function(response) {
      if (response.ok) {
        // Manipule a resposta da requisição conforme necessário
        alert('Status do Orçamento Atualizado!');
        window.location.reload();
      } else {
        alert('Erro na requisição: ' + response.statusText);
      }
    })
    .then(data => {
        // Lógica de tratamento da resposta, se necessário

    })
    .then(function(responseData) {
       if (responseData.error) {
        // Realize as ações necessárias para tratar o erro
        alert('Erro: ' + responseData.error);
      }else{
      console.log(responseData); }
      // Realize as ações necessárias com os dados da resposta
    })
    .catch(function(error) {
      console.error('Erro: ' + error.message);
    });
    });
  });
});
document.getElementById('fechar-modal-status').addEventListener('click', function() {
  document.getElementById('modal-status-pedidos').style.display = 'none';
});




</script>
<script>
var btnComentario = document.querySelectorAll('.btn-comentario');

// Itera sobre os botões encontrados
btnComentario.forEach(function(btn) {
  btn.addEventListener('click', function() {
    // Obtém o número do pedido do atributo de dados 'data-pedido-status'
    var numeroOrcamento = this.getAttribute('data-orcamento-numero');
    document.getElementById('numero_orcamento').value = numeroOrcamento;
    document.getElementById('modal-comentario').style.display = 'block';

    document.getElementById('modal-comentario-form').addEventListener('submit', function(event) {
      // Impede o comportamento padrão de submissão do formulário
      event.preventDefault();
      var novoComentario = document.getElementById('novo_comentario').value;
      var numeroOrcamento = document.getElementById('numero_orcamento').value.trim();

    console.log(status);


    // Cria um objeto de dados para enviar na requisição
    var data = {
      numero_orcamento: numeroOrcamento,
      comentario: novoComentario

    };

    // Faz a requisição para a view 'emitir_nota' usando fetch
    fetch('/adiciona_comentario/', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-CSRFToken': '{{ csrf_token }}'
      },
      body: JSON.stringify(data)
    })
    .then(function(response) {
      if (response.ok) {
        // Manipule a resposta da requisição conforme necessário
        alert('Comentario Atualizado!');

        window.location.reload();

      } else {
        alert('Erro na requisição: ' + response.statusText);

      }
    })
    .then(data => {
        // Lógica de tratamento da resposta, se necessário

    })
    .then(function(responseData) {
       if (responseData.error) {
        // Realize as ações necessárias para tratar o erro
        alert('Erro: ' + responseData.error);
      }else{
      console.log(responseData); }
      // Realize as ações necessárias com os dados da resposta
    })
    .catch(function(error) {
      console.error('Erro: ' + error.message);
    });
    });
  });
});
document.getElementById('fechar-modal-comentario').addEventListener('click', function() {
  document.getElementById('modal-comentario').style.display = 'none';
});




</script>
<script>
var btnpendenteFinanceiro = document.querySelectorAll('.btn-pendente-financeiro');

// Itera sobre os botões encontrados
btnpendenteFinanceiro.forEach(function(btn) {
  btn.addEventListener('click', function() {
    // Obtém o número do pedido do atributo de dados 'data-pedido'
    var numeroPedido = this.getAttribute('data-pedido');
    var datapa = this.getAttribute('data-pagamento-antecipado');



    var valor = this.getAttribute('data-valor-antecipado');
    document.getElementById('numero_pedido_pf').value = numeroPedido;
    document.getElementById('data-pa').value = datapa;
    document.getElementById('valor-pa').value = valor;
    document.getElementById('modal-pendente-financeiro').style.display = 'block';

    document.getElementById('modal-pf-form').addEventListener('submit', function(event) {
      // Impede o comportamento padrão de submissão do formulário
      event.preventDefault();
      var banco = document.getElementById('banco-pa').value;
      var empresa = document.getElementById('empresa-pa').value;



    console.log(status);


    // Cria um objeto de dados para enviar na requisição
    var data = {
      numero_pedido: numeroPedido,
      data: datapa,
      banco: banco,
      empresa: empresa,
      valor: valor
    };

    // Faz a requisição para a view 'emitir_nota' usando fetch
    fetch('/edita-status/', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-CSRFToken': '{{ csrf_token }}'
      },
      body: JSON.stringify(data)
    })
    .then(function(response) {
      if (response.ok) {
        // Manipule a resposta da requisição conforme necessário
        alert('Status do Pedido Atualizado!');
        window.location.reload();
      } else {
        alert('Erro na requisição: ' + response.statusText);
      }
    })
    .then(data => {
        // Lógica de tratamento da resposta, se necessário

    })
    .then(function(responseData) {
       if (responseData.error) {
        // Realize as ações necessárias para tratar o erro
        alert('Erro: ' + responseData.error);
      }else{
      console.log(responseData); }
      // Realize as ações necessárias com os dados da resposta
    })
    .catch(function(error) {
      console.error('Erro: ' + error.message);
    });
    });
  });
});
document.getElementById('fechar-modal-pf').addEventListener('click', function() {
  document.getElementById('modal-pendente-financeiro').style.display = 'none';
});




</script>



<script>
    document.addEventListener("DOMContentLoaded", function() {
    var valor = document.querySelectorAll(".valorpedido");


    valor.forEach(function(input) {
        input.addEventListener("input", function() {
            var valor = parseFloat(input.value.replace(/\D/g, ""));
            if (!isNaN(valor)) {
                input.value = formatCurrency(valor / 100);
            }
        });
    });
});

function formatCurrency(value) {
    var formatter = new Intl.NumberFormat("pt-BR", {
        style: "currency",
        currency: "BRL",
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
    });
    return formatter.format(value);
}

</script>
<!--modal comentario visualizcoes -->
<script>
var btnObservacoes = document.querySelectorAll('.btn-observacoes');

// Itera sobre os botões encontrados
btnObservacoes.forEach(function(btn) {
  btn.addEventListener('click', function() {
    // Obtém o número do pedido do atributo de dados 'data-pedido-status'
    var codigo_orcamento = this.getAttribute('data-orcamento');
    var url  = this.getAttribute('data-url');
    // document.getElementById('numero_orcamento').value = numeroOrcamento;
    document.getElementById("observacoes-iframe").src = url;
    document.getElementById('modal-comentarios-report').style.display = 'block';

  });
});
document.getElementById('fechar-modal-comentarios-report').addEventListener('click', function() {
  document.getElementById('modal-comentarios-report').style.display = 'none';
});




</script>


{% endblock %}
</body>
</html>